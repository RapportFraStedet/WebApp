$(function(){$.widget("custom.photo",{options:{imageSizeValue:100,imageQualityValue:100,id:"",required:!1,name:"",permission:2},_create:function(){this.imageSizeValue=this.options.imageSizeValue;this.imageQualityValue=this.options.imageQualityValue;var b=$("<div>",{"data-role":"fieldcontain"});this.element.append(b);var a=this._createLabel().addClass("ui-input-text");b.append(a);b=$("<div class='cameraButtons'>").appendTo(b);if(html5File())a=$("<div data-role='button' data-inline='true'>").appendTo(b).append("Fotoalbum"),
this.options.permission==1&&a.prop("disabled",!0),this.file=$("<input data-role='none' class='fotoselect' type='file' name='B"+this.options.id+"' id='B"+this.options.id+"'/>").appendTo(a),this._on(this.file,{change:"_showFile"});html5Camera()&&(a=$("<a href='#/kommune/"+Rfs.kommune.Nr+"/"+Rfs.tema.Id+"/kamera/"+this.options.id+"' data-role='button' data-inline='true' data-transition='slide'>Kamera</a>").appendTo(b),this.options.permission==1&&a.prop("disabled",!0));if(Rfs.editImage)a=$("<div data-role='collapsible'>").appendTo(b),
$("<h4>Options</h4>").appendTo(a),this.textSize=$("<div>").appendTo(a),$("<label for='imageSize-"+this.options.id+"'>Billede st\u00f8rrelse</label>").appendTo(a),this.imageSize=$("<input type='number' data-type='range' name='imageSize-"+this.options.id+"' id='imageSize-"+this.options.id+"' min='0' max='100' value='"+this.options.imageSizeValue+"' data-highlight='true'/>").appendTo(a).slider(),this._on(this.imageSize,{slidestop:function(){this.imageSizeValue=this.imageSize.val();this._changeImage()},
keyup:function(){this.imageSizeValue=this.imageSize.val();this._changeImage()}}),$("<label for='imageQuality-"+this.options.id+"'>Billede kvalitet</label>").appendTo(a),this.imageQuality=$("<input type='number' data-type='range' name='imageQuality-"+this.options.id+"' id='imageQuality-"+this.options.id+"' min='0' max='100' value='"+this.options.imageQualityValue+"' data-highlight='true'/>").appendTo(a).slider(),this._on(this.imageQuality,{slidestop:function(){this.imageQualityValue=this.imageQuality.val();
this._changeImage()},keyup:function(){this.imageQualityValue=this.imageQuality.val();this._changeImage()}});this.hidden=$("<input type='hidden' id='"+this.options.id+"' name='"+this.options.id+"' val=''/>").appendTo(this.element);this.options.required==1&&this.hidden.addClass("required");this.imageA=$("<img id='A"+this.options.id+"' width='100%'/>").appendTo(b).hide()},_createLabel:function(){var b=null;return b=this.options.required==1?$("<label for='"+this.options.id+"'><em>*</em>"+this.options.name+
"</label>"):$("<label for='"+this.options.id+"'>"+this.options.name+"</label>")},_changeImage:function(){canvasResize(this.resultFile,{scale:this.imageSizeValue,quality:this.imageQualityValue,callback:function(b){return function(a,c,e){b.imageA.attr("src",a).css("display","inline");b.hidden.val(a);var d=a.split(","),a="";if(d.length>0)d=atob(d[1]).length,d>1E6?a=(d/1048576).toFixed(1)+" Mb, ":d>1E3&&(a=Math.round(d/1024)+" Kb, ");b.textSize.text(a+c+"\u2613"+e);c<$(".cameraButtons").width()?b.imageA.width(c):
b.imageA.css("width","100%")}}(this)})},_showFile:function(){if(html5File()){var b=this.file[0].files[0];if(b.type.match("image.*")){var a=new FileReader;a.onload=function(a){return function(b){a.resultFile=b.target.result;a._changeImage()}}(this);a.readAsDataURL(b)}}},_destroy:function(){},_setOptions:function(){this._superApply(arguments);this._refresh()},_setOption:function(b,a){this._super(b,a)}})});
$("#PhotoPage").on("pageshow",function(){var b=$(window).height(),a=$("#PhotoPage").children(":jqmData(role=content)"),c=b;a.outerHeight()!==b&&(c-=a.outerHeight()-a.height(),$("#Photo").css("height",c));b=$("#photoButton");a=$(window).width();c=b.outerWidth();b.css("left",(a-c)/2);window.URL=window.URL||window.webkitURL;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;navigator.getUserMedia({video:!0},function(a){var b=
document.querySelector("video");b.src=window.URL.createObjectURL(a);stream=a;b.onloadedmetadata=function(){}},function(){$("#PhotoErrorMessage").html("<p>Fejl ved adgang til kameraet!</p>");$("#PhotoError").popup("open")})});
function snapshot(){if(stream){var b=document.querySelector("video"),a=document.querySelector("canvas");a.width=b.videoWidth;a.height=b.videoHeight;a.getContext("2d").drawImage(b,0,0);b=$("#"+imageId);b.length>0&&b.val("");$("#A"+imageId).attr("src",a.toDataURL("image/jpeg")).css("display","inline");$("#"+imageId).val(a.toDataURL("image/jpeg"));a=$("input[name='B"+imageId+"']");if(a.length>0)a.unbind("change"),a[0].outerHTML=a[0].outerHTML,$("input[name='B"+imageId+"']").bind("change",Rfs.inputChanged);
stream.stop()}backToFormular()};
