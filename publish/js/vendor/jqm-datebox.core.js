(function(c){c.widget("mobile.datebox",c.mobile.widget,{options:{version:"2-1.3.0-2013040300",theme:!1,themeDefault:"c",themeHeader:"a",mode:!1,centerHoriz:!1,centerVert:!1,transition:"pop",useAnimation:!0,hideInput:!1,hideFixedToolbars:!1,lockInput:!0,enhanceInput:!0,zindex:"500",clickEvent:"vclick",clickEventAlt:"click",resizeListener:!0,defaultValue:!1,dialogEnable:!1,dialogForce:!1,enablePopup:!1,popupPosition:!1,popupForceX:!1,popupForceY:!1,useModal:!1,useInline:!1,useInlineBlind:!1,useHeader:!0,
useImmediate:!1,useNewStyle:!1,useAltIcon:!1,overrideStyleClass:!1,useButton:!0,useFocus:!1,useClearButton:!1,useCollapsedBut:!1,usePlaceholder:!1,openCallback:!1,openCallbackArgs:[],closeCallback:!1,closeCallbackArgs:[],startOffsetYears:!1,startOffsetMonths:!1,startOffsetDays:!1,afterToday:!1,beforeToday:!1,notToday:!1,maxDays:!1,minDays:!1,maxYear:!1,minYear:!1,blackDates:!1,blackDatesRec:!1,blackDays:!1,minHour:!1,maxHour:!1,minuteStep:1,minuteStepRound:0,rolloverMode:{m:!0,d:!0,h:!0,i:!0,s:!0},
useLang:"default",lang:{"default":{setDateButtonLabel:"Set Date",setTimeButtonLabel:"Set Time",setDurationButtonLabel:"Set Duration",calTodayButtonLabel:"Jump to Today",titleDateDialogLabel:"Set Date",titleTimeDialogLabel:"Set Time",daysOfWeek:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),daysOfWeekShort:"Su,Mo,Tu,We,Th,Fr,Sa".split(","),monthsOfYear:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),monthsOfYearShort:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),
durationLabel:["Days","Hours","Minutes","Seconds"],durationDays:["Day","Days"],timeFormat:24,headerFormat:"%A, %B %-d, %Y",tooltip:"Open Date Picker",nextMonth:"Next Month",prevMonth:"Previous Month",dateFieldOrder:["m","d","y"],timeFieldOrder:["h","i","a"],slideFieldOrder:["y","m","d"],dateFormat:"%Y-%m-%d",useArabicIndic:!1,isRTL:!1,calStartDay:0,clearButton:"Clear",durationOrder:["d","h","i","s"],meridiem:["AM","PM"],timeOutput:"%k:%M",durationFormat:"%Dd %DA, %Dl:%DM:%DS",calDateListLabel:"Other Dates"}}},
_enhanceDate:function(){c.extend(this._date.prototype,{copy:function(a,b){typeof a==="undefined"&&(a=[0,0,0,0,0,0,0]);for(typeof b==="undefined"&&(b=[0,0,0,0,0,0,0]);a.length<7;)a.push(0);for(;b.length<7;)b.push(0);return new Date(b[0]>0?b[0]:this.getFullYear()+a[0],b[1]>0?b[1]:this.getMonth()+a[1],b[2]>0?b[2]:this.getDate()+a[2],b[3]>0?b[3]:this.getHours()+a[3],b[4]>0?b[4]:this.getMinutes()+a[4],b[5]>0?b[5]:this.getSeconds()+a[5],b[6]>0?b[5]:this.getMilliseconds()+a[6])},adj:function(a,b){if(typeof b!==
"number")throw Error("Adjustment value not specified");if(typeof a!=="number")throw Error("Adjustment type not specified");switch(a){case 0:this.setFullYear(this.getFullYear()+b);break;case 1:this.setMonth(this.getMonth()+b);break;case 2:this.setDate(this.getDate()+b);break;case 3:this.setHours(this.getHours()+b);break;case 4:this.setMinutes(this.getMinutes()+b);break;case 5:this.setSeconds(this.getSeconds()+b);break;case 6:this.setMilliseconds(this.getMilliseconds()+b)}return this},set:function(a,
b){switch(a){case 0:this.setFullYear(b);break;case 1:this.setMonth(b);break;case 2:this.setDate(b);break;case 3:this.setHours(b);break;case 4:this.setMinutes(b);break;case 5:this.setSeconds(b);break;case 6:this.setMilliseconds(b)}return this},get:function(a){switch(a){case 0:return this.getFullYear();case 1:return this.getMonth();case 2:return this.getDate();case 3:return this.getHours();case 4:return this.getMinutes();case 5:return this.getSeconds()}return!1},iso:function(){return String(this.getFullYear())+
"-"+(this.getMonth()<9?"0":"")+String(this.getMonth()+1)+"-"+(this.getDate()<10?"0":"")+String(this.getDate())},comp:function(){return parseInt(this.iso().replace(/-/g,""),10)},getEpoch:function(){return(this.getTime()-this.getMilliseconds())/1E3},getArray:function(){return[this.getFullYear(),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds()]},setFirstDay:function(a){this.set(2,1).adj(2,a-this.getDay());this.get(2)>10&&this.adj(2,7);return this},setWeek:function(a,
b){return a===4?this.set(1,0).set(2,1).setFirstDay(4).adj(2,-3).adj(2,(b-1)*7):this.set(1,0).set(2,1).setFirstDay(a).adj(2,(b-1)*7)},getWeek:function(a){switch(a){case 0:return a=this.copy([0,-1*this.getMonth()]).setFirstDay(0),Math.floor((this.getTime()-(a.getTime()+(this.getTimezoneOffset()-a.getTimezoneOffset())*6E4))/6048E5)+1;case 1:return a=this.copy([0,-1*this.getMonth()]).setFirstDay(1),Math.floor((this.getTime()-(a.getTime()+(this.getTimezoneOffset()-a.getTimezoneOffset())*6E4))/6048E5)+
1;case 4:if(this.getMonth()===11&&this.getDate()>28)return 1;a=this.copy([0,-1*this.getMonth()],!0).setFirstDay(4).adj(2,-3);a=Math.floor((this.getTime()-(a.getTime()+(this.getTimezoneOffset()-a.getTimezoneOffset())*6E4))/6048E5)+1;return a<1?(a=this.copy([-1,-1*this.getMonth()]).setFirstDay(4).adj(2,-3),Math.floor((this.getTime()-a.getTime())/6048E5)+1):a;default:return 0}}})},_event:function(a,b){var f=parseInt(c.mobile.version.replace(/\./g,""),10)>110?c(this).data("mobileDatebox"):c(this).data("datebox");
if(!a.isPropagationStopped())switch(b.method){case "close":f.close();break;case "open":f.open();break;case "set":c(this).val(b.value);c(this).trigger("change");break;case "doset":c.isFunction(f["_"+f.options.mode+"DoSet"])?f["_"+f.options.mode+"DoSet"].apply(f,[]):c(this).trigger("datebox",{method:"set",value:f._formatter(f.__fmt(),f.theDate),date:f.theDate});break;case "dooffset":b.type&&f._offset(b.type,b.amount,!0);break;case "dorefresh":f.refresh();break;case "doreset":f.hardreset();break;case "doclear":c(this).val("").trigger("change");
break;case "clear":c(this).trigger("change")}},_hoover:function(a){c(a).toggleClass("ui-btn-up-"+c(a).jqmData("theme")+" ui-btn-down-"+c(a).jqmData("theme"))},_ord:{"default":function(a){var b=a%10;return a>9&&a<21?"th":b>3?"th":["th","st","nd","rd"][b]}},__:function(a){var b=this.options,f="override"+a.charAt(0).toUpperCase()+a.slice(1);return typeof b[f]!=="undefined"?b[f]:typeof b.lang[b.useLang][a]!=="undefined"?b.lang[b.useLang][a]:typeof b[b.mode+"lang"]!=="undefined"&&typeof b[b.mode+"lang"][a]!==
"undefined"?b[b.mode+"lang"][a]:b.lang["default"][a]},__fmt:function(){switch(this.options.mode){case "timebox":case "timeflipbox":return this.__("timeOutput");case "durationbox":case "durationflipbox":return this.__("durationFormat");default:return this.__("dateFormat")}},_zPad:function(a){return a<10?"0"+String(a):String(a)},_dRep:function(a,b){var f=48,c=57,g=1584,h=null,e=null,j="";b===-1&&(f+=g,c+=g,g=-1584);for(h=0;h<a.length;h++)e=a.charCodeAt(h),j+=e>=f&&e<=c?String.fromCharCode(e+g):String.fromCharCode(e);
return j},_doIndic:function(){var a=this;a.d.intHTML.find("*").each(function(){c(this).children().length<1?c(this).text(a._dRep(c(this).text())):c(this).hasClass("ui-datebox-slideday")&&c(this).html(a._dRep(c(this).html()))});a.d.intHTML.find("input").each(function(){c(this).val(a._dRep(c(this).val()))})},_parser:{"default":function(){return!1}},_n:function(a,b){return a<0?b:a},_pa:function(a,b){return typeof b==="boolean"?new this._date(a[0],a[1],a[2],0,0,0,0):new this._date(b.getFullYear(),b.getMonth(),
b.getDate(),a[0],a[1],a[2],0)},_makeDate:function(a){var a=c.trim(this.__("useArabicIndic")===!0?this._dRep(a,-1):a),b=this.options,f=this.__fmt(),d=null,g=[],h=null,e=null,j=new this._date,n=-1,k=-1,l=-1,m=-1,o=-1,p=-1,q=!1,r=4,s=!1,u=!1,t=0;if(typeof b.mode==="undefined")return j;if(typeof this._parser[b.mode]!=="undefined")return this._parser[b.mode].apply(this,[a]);if(b.mode==="durationbox"||b.mode==="durationflipbox"){f=f.replace(/%D([a-z])/gi,function(a,b){switch(b){case "d":case "l":case "M":case "S":return"("+
a+"|[0-9]+)";default:return".+?"}});f=RegExp("^"+f+"$");d=f.exec(a);h=f.exec(this.__fmt());if(d===null||d.length!==h.length)return typeof b.defaultValue==="number"&&b.defaultValue>0?new this._date((this.initDate.getEpoch()+parseInt(b.defaultValue,10))*1E3):new this._date(this.initDate.getTime());e=this.initDate.getEpoch();for(a=0;a<d.length;a++)h[a].match(/^%Dd$/i)&&(e+=parseInt(d[a],10)*86400),h[a].match(/^%Dl$/i)&&(e+=parseInt(d[a],10)*3600),h[a].match(/^%DM$/i)&&(e+=parseInt(d[a],10)*60),h[a].match(/^%DS$/i)&&
(e+=parseInt(d[a],10));return new this._date(e*1E3)}f=f.replace(/%(0|-)*([a-z])/gi,function(a,b,c){g.push(c);switch(c){case "p":case "P":case "b":case "B":return"("+a+"|.+?)";case "H":case "k":case "I":case "l":case "m":case "M":case "S":case "V":case "U":case "u":case "W":case "d":return"("+a+"|"+(b==="-"?"[0-9]{1,2}":"[0-9]{2}")+")";case "j":return"("+a+"|[0-9]{3})";case "s":return"("+a+"|[0-9]+)";case "g":case "y":return"("+a+"|[0-9]{2})";case "E":case "G":case "Y":return"("+a+"|[0-9]{1,4})";default:return g.pop(),
".+?"}});f=RegExp("^"+f+"$");d=f.exec(a);h=f.exec(this.__fmt());if(d===null||d.length!==h.length){if(b.defaultValue!==!1)switch(typeof b.defaultValue){case "object":b.defaultValue.length===3&&(j=this._pa(b.defaultValue,b.mode==="timebox"||b.mode==="timeflipbox"?j:!1));break;case "number":j=new this._date(b.defaultValue*1E3);break;case "string":b.mode==="timebox"||b.mode==="timeflipbox"?(e=b.defaultValue.split(":"),e.length===3?j=this._pa([e[0],e[1],e[2]],j):e.length===2&&(j=this._pa([e[0],e[1],0],
j))):(e=b.defaultValue.split("-"),e.length===3&&(j=this._pa([e[0],e[1]-1,e[2]],!1)))}isNaN(j.getDate())&&(j=new this._date)}else{for(a=1;a<d.length;a++)switch(g[a-1]){case "s":return new this._date(parseInt(d[a],10)*1E3);case "Y":case "G":n=parseInt(d[a],10);break;case "E":n=parseInt(d[a],10)-543;break;case "y":case "g":n=b.afterToday===!0||parseInt(d[a],10)<38?parseInt("20"+d[a],10):parseInt("19"+d[a],10);break;case "m":k=parseInt(d[a],10)-1;break;case "d":l=parseInt(d[a],10);break;case "H":case "k":case "I":case "l":m=
parseInt(d[a],10);break;case "M":o=parseInt(d[a],10);break;case "S":p=parseInt(d[a],10);break;case "u":s=parseInt(d[a],10)-1;break;case "w":s=parseInt(d[a],10);break;case "j":u=parseInt(d[a],10);break;case "V":q=parseInt(d[a],10);r=4;break;case "U":q=parseInt(d[a],10);r=0;break;case "W":q=parseInt(d[a],10);r=1;break;case "p":case "P":t=d[a].toLowerCase()===this.__("meridiem")[0].toLowerCase()?-1:1;break;case "b":e=c.inArray(d[a],this.__("monthsOfYearShort"));e>-1&&(k=e);break;case "B":e=c.inArray(d[a],
this.__("monthsOfYear")),e>-1&&(k=e)}t!==0&&(t===-1&&m===12&&(m=0),t===1&&m!==12&&(m+=12));j=new this._date(this._n(n,0),this._n(k,0),this._n(l,1),this._n(m,0),this._n(o,0),this._n(p,0),0);n<100&&n!==-1&&j.setFullYear(n);if(k>-1&&l>-1||m>-1&&o>-1&&p>-1)return j;q!==!1&&(j.setWeek(r,q),l>-1&&j.setDate(l));u!==!1&&j.set(1,0).set(2,1).adj(2,u-1);s!==!1&&j.adj(2,s-j.getDay())}return j},_customformat:{"default":function(){return!1}},_formatter:function(a,b){var c=this,d=this.options,g,h=[0,0,0,0],e=0;
if(d.mode==="durationbox"||d.mode==="durationflipbox")e=this.theDate.getEpoch()-this.initDate.getEpoch(),h[0]=parseInt(e/86400,10),e-=h[0]*86400,h[1]=parseInt(e/3600,10),e-=h[1]*3600,h[2]=parseInt(e/60,10),e-=h[2]*60,h[3]=e,a.match(/%Dd/)||(h[1]+=h[0]*24),a.match(/%Dl/)||(h[2]+=h[1]*60),a.match(/%DM/)||(h[3]+=h[2]*60);a=a.replace(/%(D|X|0|-)*([1-9a-zA-Z])/g,function(a,e,k){if(e==="X")return typeof c._customformat[d.mode]!=="undefined"?c._customformat[d.mode](k,b):a;if(e==="D")switch(k){case "d":return h[0];
case "l":return c._zPad(h[1]);case "M":return c._zPad(h[2]);case "S":return c._zPad(h[3]);case "A":return h[0]>1?c.__("durationDays")[1]:c.__("durationDays")[0];default:return a}switch(k){case "%":return"%";case "a":return c.__("daysOfWeekShort")[b.getDay()];case "A":return c.__("daysOfWeek")[b.getDay()];case "b":return c.__("monthsOfYearShort")[b.getMonth()];case "B":return c.__("monthsOfYear")[b.getMonth()];case "C":return b.getFullYear().toString().substr(0,2);case "d":return e==="-"?b.getDate():
c._zPad(b.getDate());case "H":case "k":return e==="-"?b.getHours():c._zPad(b.getHours());case "I":case "l":return e==="-"?b.getHours()===0||b.getHours()===12?12:b.getHours()<12?b.getHours():b.getHours()-12:c._zPad(b.getHours()===0||b.getHours()===12?12:b.getHours()<12?b.getHours():b.getHours()-12);case "m":return e==="-"?b.getMonth()+1:c._zPad(b.getMonth()+1);case "M":return e==="-"?b.getMinutes():c._zPad(b.getMinutes());case "p":return b.getHours()<12?c.__("meridiem")[0].toUpperCase():c.__("meridiem")[1].toUpperCase();
case "P":return b.getHours()<12?c.__("meridiem")[0].toLowerCase():c.__("meridiem")[1].toLowerCase();case "s":return b.getEpoch();case "S":return e==="-"?b.getSeconds():c._zPad(b.getSeconds());case "u":return e==="-"?b.getDay()+1:c._zPad(b.getDay()+1);case "w":return b.getDay();case "y":return b.getFullYear().toString().substr(2,2);case "Y":return b.getFullYear();case "E":return b.getFullYear()+543;case "V":return e==="-"?b.getWeek(4):c._zPad(b.getWeek(4));case "U":return e==="-"?b.getWeek(0):c._zPad(b.getWeek(0));
case "W":return e==="-"?b.getWeek(1):c._zPad(b.getWeek(1));case "o":return typeof c._ord[d.useLang]!=="undefined"?c._ord[d.useLang](b.getDate()):c._ord["default"](b.getDate());case "j":return g=new Date(b.getFullYear(),0,1),g=Math.ceil((b-g)/864E5)+1,(g<100?g<10?"00":"0":"")+String(g);case "G":return b.getWeek(4)===1&&b.getMonth()>0?b.getFullYear()+1:b.getWeek(4)>51&&b.getMonth()<11?b.getFullYear()-1:b.getFullYear();case "g":return b.getWeek(4)===1&&b.getMonth()>0?parseInt(b.getFullYear().toString().substr(2,
2),10)+1:b.getWeek(4)>51&&b.getMonth()<11?parseInt(b.getFullYear().toString().substr(2,2),10)-1:b.getFullYear().toString().substr(2,2);default:return a}});c.__("useArabicIndic")===!0&&(a=c._dRep(a));return a},_btwn:function(a,b,c){return a>b&&a<c},_minStepFix:function(){var a=this.theDate.get(4),b=this.options;b.minuteStep>1&&a%b.minuteStep>0&&(b.minuteStepRound<0?a-=a%b.minuteStep:b.minStepRound>0?a+=b.minuteStep-a%b.minuteStep:a%b.minuteStep<b.minuteStep/2?a-=a%b.minuteStep:a+=b.minuteStep-a%b.minuteStep,
this.theDate.setMinutes(a))},_offset:function(a,b,f){var d=this.options,g=!1,a=(a||"").toLowerCase();typeof f==="undefined"&&(f=!0);this.d.input.trigger("datebox",{method:"offset",type:a,amount:b});if(a!=="a"&&(typeof d.rolloverMode[a]==="undefined"||d.rolloverMode[a]===!0))g=c.inArray(a,"y,m,d,h,i,s".split(","));else switch(a){case "y":g=0;break;case "m":this._btwn(this.theDate.getMonth()+b,-1,12)&&(g=1);break;case "d":this._btwn(this.theDate.getDate()+b,0,32-this.theDate.copy([0],[0,0,32,13]).getDate()+
1)&&(g=2);break;case "h":this._btwn(this.theDate.getHours()+b,-1,24)&&(g=3);break;case "i":this._btwn(this.theDate.getMinutes()+b,-1,60)&&(g=4);break;case "s":this._btwn(this.theDate.getSeconds()+b,-1,60)&&(g=5);break;case "a":this._offset("h",(b>0?1:-1)*12,!1)}g!==!1&&this.theDate.adj(g,b);f===!0&&this.refresh();d.useImmediate&&this.d.input.trigger("datebox",{method:"doset"})},_startOffset:function(a){var b=this.options;b.startOffsetYears!==!1&&a.adj(0,b.startOffsetYears);b.startOffsetMonths!==!1&&
a.adj(1,b.startOffsetMonths);b.startOffsetDays!==!1&&a.adj(2,b.startOffsetDays);return a},_create:function(){c(document).trigger("dateboxcreate");var a=this,b=c.extend(this.options,typeof this.element.jqmData("options")!=="undefined"?this.element.jqmData("options"):this._getLongOptions(this.element)),f=b.theme===!1&&typeof c(this).jqmData("theme")==="undefined"?typeof this.element.parentsUntil(":jqmData(theme)").parent().jqmData("theme")==="undefined"?b.themeDefault:this.element.parentsUntil(":jqmData(theme)").parent().jqmData("theme"):
b.theme,d=b.useAnimation?b.transition:"none",d=b.useNewStyle===!1?{input:this.element,wrap:this.element.wrap('<div class="ui-input-datebox ui-shadow-inset ui-corner-all '+(this.element.jqmData("mini")===!0?"ui-mini ":"")+"ui-body-"+f+'"></div>').parent(),mainWrap:c("<div>",{"class":"ui-datebox-container ui-overlay-shadow ui-corner-all ui-datebox-hidden "+d+" ui-body-"+f}).css("zIndex",b.zindex),intHTML:!1}:{input:this.element,wrap:this.element,mainWrap:c("<div>",{"class":"ui-datebox-container ui-overlay-shadow ui-corner-all ui-datebox-hidden "+
d+" ui-body-"+f}).css("zIndex",b.zindex),intHTML:!1},g=typeof window.ontouchstart!=="undefined";c.extend(a,{d:d,ns:typeof c.mobile.ns!=="undefined"?c.mobile.ns:"",drag:{eStart:(g?"touchstart":"mousedown")+".datebox",eMove:(g?"touchmove":"mousemove")+".datebox",eEnd:(g?"touchend":"mouseup")+".datebox",eEndA:g?"mouseup.datebox touchend.datebox touchcancel.datebox touchmove.datebox":"mouseup.datebox",move:!1,start:!1,end:!1,pos:!1,target:!1,delta:!1,tmp:!1},touch:g});b.usePlaceholder!==!1&&(b.usePlaceholder===
!0&&a._grabLabel()!==!1&&a.d.input.attr("placeholder",a._grabLabel()),typeof b.usePlaceholder==="string"&&a.d.input.attr("placeholder",b.usePlaceholder));b.theme=f;a.clearFunc=!1;a.disabled=!1;a.runButton=!1;a._date=window.Date;a._enhanceDate();a.baseID=a.d.input.attr("id");a.initDate=new a._date;a.theDate=b.defaultValue?a._makeDate(b.defaultValue):new a._date;a.initDone=!1;if(b.useButton===!0&&b.useInline===!1&&b.useNewStyle===!1)a.d.open=c('<a href="#" class="ui-input-clear" title="'+this.__("tooltip")+
'">'+this.__("tooltip")+"</a>").on(b.clickEvent,function(b){b.preventDefault();a.disabled||(a.d.input.trigger("datebox",{method:"open"}),a.d.wrap.addClass("ui-focus"),a.d.input.parent().removeClass("ui-focus"));setTimeout(function(){c(b.target).closest("a").removeClass(c.mobile.activeBtnClass)},300)}).appendTo(a.d.wrap).buttonMarkup({icon:"grid",iconpos:"notext",corners:!0,shadow:!0}).css({"vertical-align":"middle",display:"inline-block"});a.d.screen=c("<div>",{"class":"ui-datebox-screen ui-datebox-hidden"+
(b.useModal?" ui-datebox-screen-modal":"")}).css({"z-index":b.zindex-1}).on(b.clickEventAlt,function(b){b.preventDefault();a.d.input.trigger("datebox",{method:"close"})});a.inputType=b.enhanceInput===!0&&navigator.userAgent.match(/Android/i)?"number":"text";b.hideInput&&a.d.wrap.hide();c("label[for='"+a.d.input.attr("id")+"']").addClass("ui-input-text").css("verticalAlign","middle");a.d.wrap.on(b.clickEvent,function(){if(!a.disabled&&(b.noButtonFocusMode||b.focusMode))a.d.input.trigger("datebox",
{method:"open"}),a.d.wrap.addClass("ui-focus"),a.d.input.removeClass("ui-focus")});a.d.input.removeClass("ui-corner-all ui-shadow-inset").bind(a.touch?"touchend":"click",function(c){if(a.disabled===!1&&b.useNewStyle===!0&&b.useFocus===!1&&(a.touch?c.originalEvent.changedTouches[0].pageX:c.pageX)-c.target.offsetLeft>c.target.offsetWidth-20)a.d.input.trigger("datebox",{method:"open"}),a.d.wrap.addClass("ui-focus"),a.d.input.removeClass("ui-focus")}).focus(function(){a.disabled===!1&&b.useFocus===!0&&
(a.d.input.trigger("datebox",{method:"open"}),a.d.wrap.addClass("ui-focus"));b.useNewStyle===!1&&a.d.input.removeClass("ui-focus")}).blur(function(){a.d.wrap.removeClass("ui-focus");a.d.input.removeClass("ui-focus")}).change(function(){a.theDate=a._makeDate(a.d.input.val());a.refresh()}).attr("readonly",b.lockInput).on("datebox",a._event);b.useNewStyle===!0?(a.d.input.addClass("ui-corner-all "+(b.useAltIcon===!0?"ui-icon-datebox-alt":"ui-icon-datebox")),b.overrideStyleClass!==!1&&a.d.input.addClass(b.overrideStyleClass)):
a.d.input.parent().css("border","none").removeClass("ui-shadow-inset");if(typeof c.event.special.mousewheel!=="undefined")a.wheelExists=!0;a.d.input.is(":disabled")&&a.disable();(b.useInline===!0||b.useInlineBlind)&&a.open();a.applyMinMax(!1,!1);c(document).trigger("dateboxaftercreate")},applyMinMax:function(a,b){var c=this.options,d,g,h;typeof a==="undefined"&&(a=!1);typeof b==="undefined"&&(b=!0);if((b===!0||c.minDays===!1)&&typeof this.d.input.attr("min")!=="undefined")d=new this._date,g=864E5,
d=new this._date(d.getFullYear(),d.getMonth(),d.getDate(),0,0,0,0),h=this.d.input.attr("min").split("-"),h=new this._date(h[0],h[1]-1,h[2],0,0,0,0),c.minDays=parseInt((h.getTime()-d.getTime())/g*-1,10);if((b===!0||c.maxDays===!1)&&typeof this.d.input.attr("max")!=="undefined")d=new this._date,g=864E5,d=new this._date(d.getFullYear(),d.getMonth(),d.getDate(),0,0,0,0),h=this.d.input.attr("max").split("-"),h=new this._date(h[0],h[1]-1,h[2],0,0,0,0),c.maxDays=parseInt((h.getTime()-d.getTime())/g,10);
a===!0&&this.refresh()},_build:{"default":function(){this.d.headerText="Error";this.d.intHTML=c("<div class='ui-body-e'><h2 style='text-align:center'>There is no mode by that name loaded / mode not given</h2></div>")}},_applyCoords:function(a){var b=a.widget,a=a.widget.options,f=c.mobile.activePage.find(".ui-header").jqmData("position"),d=c.mobile.activePage.find(".ui-footer").jqmData("position"),g=c.mobile.activePage.find(".ui-footer").outerHeight(),h=c.mobile.activePage.find(".ui-header").outerHeight(),
e=b.d.wrap.offset().left+b.d.wrap.outerWidth()/2,j=b.d.wrap.offset().top+b.d.wrap.outerHeight()/2,n=b.d.mainWrap.outerWidth(),k=b.d.mainWrap.outerHeight(),l=c(window).scrollTop(),m=c(window).height(),o=c.mobile.activePage.width(),p=c(document).height(),j=a.centerVert?l+(m/2-k/2):j-k/2,e=o<400||a.centerHoriz?o/2-n/2:e-n/2;if(a.centerVert===!1){if(a.hideFixedToolbars===!0&&(typeof d!=="undefined"||typeof f!=="undefined"))c.mobile.activePage.find(":jqmData(position='fixed')").fixedtoolbar("hide"),f=
d=void 0;typeof d!=="undefined"?j+k>m-g-2&&(j=m-g-2-k):(j+k>p-g-2&&(j=p-g-2-k),m+l<k+j+2&&(j=m+l-k-2));typeof f!=="undefined"?l+h+2>j&&(j=l+h+2):(h+2>j&&(j=h+2),j<l+2&&(j=l+2))}b.d.mainWrap.css({position:"absolute",top:j,left:e})},_drag:{"default":function(){return!1}},open:function(){var a=this,b=this.options,f={},d={history:!1},g="data-"+this.ns,h=b.useAnimation?b.transition:"none";if(b.useFocus===!0&&a.fastReopen===!0)return a.d.input.blur(),!1;if(a.clearFunc!==!1)clearTimeout(a.clearFunc),a.clearFunc=
!1;if(b.openCallback!==!1){if(!c.isFunction(b.openCallback))b.openCallback=typeof window[b.openCallback]!=="undefined"?window[b.openCallback]:new Function(b.openCallback);if(b.openCallback.apply(a,c.merge([a.theDate],b.openCallbackArgs))===!1)return!1}a.theDate=a._makeDate(a.d.input.val());a.d.input.val()===""&&a._startOffset(a.theDate);a.d.input.blur();typeof a._build[b.mode]==="undefined"?a._build["default"].apply(a,[]):a._build[b.mode].apply(a,[]);typeof a._drag[b.mode]!=="undefined"&&a._drag[b.mode].apply(a,
[]);a.d.input.trigger("datebox",{method:"refresh"});a.__("useArabicIndic")===!0&&a._doIndic();if((b.useInline===!0||b.useInlineBlind===!0)&&a.initDone===!1)a.d.mainWrap.append(a.d.intHTML),a.d.input.parent().parent().append(a.d.mainWrap),a.d.mainWrap.removeClass("ui-datebox-hidden"),b.useInline===!0?a.d.mainWrap.addClass("ui-datebox-inline"):(a.d.mainWrap.addClass("ui-datebox-inlineblind"),a.d.mainWrap.hide()),a.initDone=!1,a.d.input.trigger("datebox",{method:"postrefresh"});b.useImmediate&&a.d.input.trigger("datebox",
{method:"doset"});if(b.useInline)return!0;if(b.useInlineBlind)return a.initDone?a.d.mainWrap.slideDown():a.initDone=!0,!0;if(a.d.intHTML.is(":visible"))return!1;if(b.enablePopup===!0){a.d.dialogPage=!1;a.d.mainWrap.empty();if(b.useHeader===!0)a.d.headHTML=c('<div class="ui-header ui-bar-'+b.themeHeader+'"></div>'),c("<a class='ui-btn-left' href='#'>Close</a>").appendTo(a.d.headHTML).buttonMarkup({theme:b.themeHeader,icon:"delete",iconpos:"notext",corners:!0,shadow:!0}).on(b.clickEventAlt,function(b){b.preventDefault();
a.d.input.trigger("datebox",{method:"close"})}),c('<h1 class="ui-title">'+a.d.headerText+"</h1>").appendTo(a.d.headHTML),a.d.mainWrap.append(a.d.headHTML);a.d.mainWrap.append(a.d.intHTML).css("zIndex",b.zindex);a.d.input.trigger("datebox",{method:"postrefresh"});f.transition=b.useAnimation===!0?b.transition:"none";if(b.popupForceX!==!1&&b.popupForceY!==!1)f.x=b.popupForceX,f.y=b.popupForceY;f.positionTo=b.popupPosition!==!1?b.popupPosition:typeof a.baseID!==void 0?"#"+a.baseID:"window";b.useModal=
!0;d.overlayTheme="a";a.d.mainWrap.removeClass("ui-datebox-hidden").popup(d).popup("open",f);a.refresh()}else if(b.dialogForce||b.dialogEnable&&window.width()<400)a.d.dialogPage=c("<div "+g+"role='dialog' "+g+"theme='"+b.theme+"' ><div "+g+"role='header' "+g+"theme='"+b.themeHeader+"'><h1>"+a.d.headerText+"</h1></div><div "+g+"role='content'></div>").appendTo(c.mobile.pageContainer).page().css("minHeight","0px").addClass(h),a.d.dialogPage.find(".ui-header").find("a").off("click vclick").on(b.clickEventAlt,
function(b){b.preventDefault();a.d.input.trigger("datebox",{method:"close"})}),a.d.mainWrap.append(a.d.intHTML).css({marginLeft:"auto",marginRight:"auto"}).removeClass("ui-datebox-hidden"),a.d.dialogPage.find(".ui-content").append(a.d.mainWrap),a.d.input.trigger("datebox",{method:"postrefresh"}),c.mobile.activePage.off("pagehide.remove"),c.mobile.changePage(a.d.dialogPage,{transition:h});else{a.d.dialogPage=!1;a.d.mainWrap.empty();if(b.useHeader===!0)a.d.headHTML=c('<div class="ui-header ui-bar-'+
b.themeHeader+'"></div>'),c("<a class='ui-btn-left' href='#'>Close</a>").appendTo(a.d.headHTML).buttonMarkup({theme:b.themeHeader,icon:"delete",iconpos:"notext",corners:!0,shadow:!0}).on(b.clickEventAlt,function(b){b.preventDefault();a.d.input.trigger("datebox",{method:"close"})}),c('<h1 class="ui-title">'+a.d.headerText+"</h1>").appendTo(a.d.headHTML),a.d.mainWrap.append(a.d.headHTML);a.d.mainWrap.append(a.d.intHTML).css("zIndex",b.zindex);a.d.mainWrap.appendTo(c.mobile.activePage);a.d.screen.appendTo(c.mobile.activePage);
a.d.input.trigger("datebox",{method:"postrefresh"});a._applyCoords({widget:a});b.useModal===!0?b.useAnimation?a.d.screen.fadeIn("slow"):a.d.screen.show():setTimeout(function(){a.d.screen.removeClass("ui-datebox-hidden")},500);a.d.mainWrap.addClass("ui-overlay-shadow in").removeClass("ui-datebox-hidden");c(document).on("orientationchange.datebox",{widget:a},function(b){a._applyCoords(b.data)});if(b.resizeListener===!0)c(window).on("resize.datebox",{widget:a},function(b){a._applyCoords(b.data)})}},
close:function(){var a=this,b=this.options;if(b.useInlineBlind===!0)return a.d.mainWrap.slideUp(),!0;if(b.useInline===!0||a.d.intHTML===!1)return!0;if(a.d.dialogPage!==!1){c(a.d.dialogPage).dialog("close");if(!c.mobile.activePage.jqmData("page").options.domCache)c.mobile.activePage.on("pagehide.remove",function(){c(this).remove()});a.d.intHTML.detach().empty();a.d.mainWrap.detach().empty();a.d.wrap.removeClass("ui-focus");a.clearFunc=setTimeout(function(){a.d.dialogPage.empty().remove();a.clearFunc=
!1},1500)}else b.enablePopup===!0?(a.d.mainWrap.popup("close"),a.d.wrap.removeClass("ui-focus")):(b.useModal?b.useAnimation?a.d.screen.fadeOut("slow"):a.d.screen.hide():a.d.screen.addClass("ui-datebox-hidden"),a.d.screen.detach(),a.d.mainWrap.addClass("ui-datebox-hidden").removeAttr("style").removeClass("in ui-overlay-shadow").empty().detach(),a.d.intHTML.detach(),a.d.wrap.removeClass("ui-focus"),c(document).off("orientationchange.datebox"),b.resizeListener===!0&&c(window).off("resize.datebox"));
c(document).off(a.drag.eMove);c(document).off(a.drag.eEnd);c(document).off(a.drag.eEndA);if(b.useFocus)a.fastReopen=!0,setTimeout(function(a){return function(){a.fastReopen=!1}}(a),300);if(b.closeCallback!==!1){if(!c.isFunction(b.closeCallback))b.closeCallback=typeof window[b.closeCallback]!=="undefined"?window[b.closeCallback]:new Function(b.closeCallback);b.closeCallback.apply(a,c.merge([a.theDate],b.closeCallbackArgs))}},refresh:function(){typeof this._build[this.options.mode]==="undefined"?this._build["default"].apply(this,
[]):this._build[this.options.mode].apply(this,[]);this.__("useArabicIndic")===!0&&this._doIndic();this.d.mainWrap.append(this.d.intHTML);this.d.input.trigger("datebox",{method:"postrefresh"})},_check:function(){var a=null,b=this.options;this.dateOK=!0;if(b.afterToday!==!1&&(a=new this._date,this.theDate<a))this.theDate=a;if(b.beforeToday!==!1&&(a=new this._date,this.theDate>a))this.theDate=a;if(b.maxDays!==!1&&(a=new this._date,a.adj(2,b.maxDays),this.theDate>a))this.theDate=a;if(b.minDays!==!1&&
(a=new this._date,a.adj(2,-1*b.minDays),this.theDate<a))this.theDate=a;b.minHour!==!1&&this.theDate.getHours()<b.minHour&&this.theDate.setHours(b.minHour);b.maxHour!==!1&&this.theDate.getHours()>b.maxHour&&this.theDate.setHours(b.maxHour);if(b.maxYear!==!1&&(a=new this._date(b.maxYear,0,1),a.adj(2,-1),this.theDate>a))this.theDate=a;if(b.minYear!==!1&&(a=new this._date(b.minYear,0,1),this.theDate<a))this.theDate=a;if(c.inArray(b.mode,["timebox","durationbox","durationflipbox","timeflipbox"])>-1){if(b.mode===
"timeflipbox"&&b.validHours!==!1&&c.inArray(this.theDate.getHours(),b.validHours)<0)this.dateOK=!1}else{if(b.blackDatesRec!==!1)for(i=0;i<b.blackDatesRec.length;i++)if((b.blackDatesRec[i][0]===-1||b.blackDatesRec[i][0]===year)&&(b.blackDatesRec[i][1]===-1||b.blackDatesRec[i][1]===month)&&(b.blackDatesRec[i][2]===-1||b.blackDatesRec[i][2]===date))this.dateOK=!1;if(b.blackDates!==!1&&c.inArray(this.theDate.iso(),b.blackDates)>-1)this.dateOK=!1;if(b.blackDays!==!1&&c.inArray(this.theDate.getDay(),b.blackDays)>
-1)this.dateOK=!1}},_grabLabel:function(){var a=this.options;return typeof a.overrideDialogLabel==="undefined"?typeof this.d.input.attr("placeholder")!=="undefined"?this.d.input.attr("placeholder"):typeof this.d.input.attr("title")!=="undefined"?this.d.input.attr("title"):this.d.wrap.parent().find("label[for='"+this.d.input.attr("id")+"']").text()!==""?this.d.wrap.parent().find("label[for='"+this.d.input.attr("id")+"']").text():!1:a.overrideDialogLabel},_makeEl:function(a,b){var c=!1,d=!1,d=a.clone();
if(typeof b.attr!=="undefined")for(c in b.attr)b.attr.hasOwnProperty(c)&&d.jqmData(c,b.attr[c]);return d},_getLongOptions:function(a){var b,f={},d,g;d=c.mobile.ns===""?"datebox":c.mobile.ns.substr(0,c.mobile.ns.length-1)+"Datebox";for(b in a.data())b.substr(0,d.length)===d&&b.length>d.length&&(g=b.substr(d.length),g=g.charAt(0).toLowerCase()+g.slice(1),f[g]=a.data(b));return f},disable:function(){this.d.input.attr("disabled",!0);this.d.wrap.addClass("ui-disabled").blur();this.disabled=!0;this.d.input.trigger("datebox",
{method:"disable"})},enable:function(){this.d.input.attr("disabled",!1);this.d.wrap.removeClass("ui-disabled");this.disabled=!1;this.d.input.trigger("datebox",{method:"enable"})},_setOption:function(){c.Widget.prototype._setOption.apply(this,arguments);this.refresh()},getTheDate:function(){return this.theDate},getLastDur:function(){return this.lastDuration},setTheDate:function(a){this.theDate=a;this.refresh()},callFormat:function(a,b){return this._formatter(a,b)}});c(document).on("pagebeforecreate",
function(a){c(":jqmData(role='datebox')",a.target).each(function(){c(this).prop("type","text")})});c(document).on("pagecreate create",function(a){c(document).trigger("dateboxbeforecreate");c(":jqmData(role='datebox')",a.target).each(function(){(parseInt(c.mobile.version.replace(/\./g,""),10)>111?typeof c(this).data("mobileDatebox"):typeof c(this).data("datebox"))==="undefined"&&c(this).datebox()})})})(jQuery);
