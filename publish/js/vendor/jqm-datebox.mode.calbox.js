(function(c){c.extend(c.mobile.datebox.prototype.options,{themeDateToday:"a",themeDayHigh:"e",themeDatePick:"a",themeDateHigh:"e",themeDateHighAlt:"e",themeDate:"d",calHighToday:!0,calHighPick:!0,calShowDays:!0,calOnlyMonth:!1,calWeekMode:!1,calWeekModeDay:1,calWeekHigh:!1,calControlGroup:!1,calShowWeek:!1,calUsePickers:!1,calNoHeader:!1,useTodayButton:!1,useCollapsedBut:!1,highDays:!1,highDates:!1,highDatesAlt:!1,enableDates:!1});c.extend(c.mobile.datebox.prototype,{_cal_gen:function(a,c,f,b,g){for(var e=
0,h=0,i=1,k=1,l=[],j=[],m=!1,e=0;e<=5;e++)if(m===!1){j=[];for(h=0;h<=6;h++)e===0&&h<a?b===!0?j.push([c+(h-a)+1,g-1]):j.push(!1):e>3&&i>f?(b===!0?(j.push([k,g+1]),k++):j.push(!1),m=!0):(j.push([i,g]),i++,i>f&&(m=!0));l.push(j)}return l},_cal_check:function(a,d,f,b){var g=this.options,e={},h=(new this._date(d,f,b,0,0,0,0)).getDay();e.ok=!0;e.iso=d+"-"+this._zPad(f+1)+"-"+this._zPad(b);e.comp=parseInt(e.iso.replace(/-/g,""),10);e.theme=g.themeDate;if(c.isArray(g.enableDates)&&c.inArray(e.iso,g.enableDates)<
0)e.ok=!1;else if(a.checkDates&&(g.afterToday===!0&&a.thisDate.comp()>e.comp||g.beforeToday===!0&&a.thisDate.comp()<e.comp||g.notToday===!0&&a.thisDate.comp()===e.comp||g.maxDays!==!1&&a.maxDate.comp()<e.comp||g.minDays!==!1&&a.minDate.comp()>e.comp||c.isArray(g.blackDays)&&c.inArray(h,g.blackDays)>-1||c.isArray(g.blackDates)&&c.inArray(e.iso,g.blackDates)>-1))e.ok=!1;if(e.ok)if(g.calHighPick&&b===a.presetDay)e.theme=g.themeDatePick;else if(g.calHighToday&&e.comp===a.thisDate.comp())e.theme=g.themeDateToday;
else if(c.isArray(g.highDatesAlt)&&c.inArray(e.iso,g.highDatesAlt)>-1)e.theme=g.themeDateHighAlt;else if(c.isArray(g.highDates)&&c.inArray(e.iso,g.highDates)>-1)e.theme=g.themeDateHigh;else if(c.isArray(g.highDays)&&c.inArray(h,g.highDays)>-1)e.theme=g.themeDayHigh;return e}});c.extend(c.mobile.datebox.prototype._build,{calbox:function(){var a=this,d=this.options,f,b=!1,g=!1,e=f=!1,h=!1,i=!1;typeof a.d.intHTML!=="boolean"&&a.d.intHTML.remove();a.d.headerText=a._grabLabel()!==!1?a._grabLabel():a.__("titleDateDialogLabel");
a.d.intHTML=c("<span>");c('<div class="ui-datebox-gridheader"><div class="ui-datebox-gridlabel"><h4>'+a.__("monthsOfYear")[a.theDate.getMonth()]+" "+a.theDate.getFullYear()+"</h4></div></div>").appendTo(a.d.intHTML);c("<div class='ui-datebox-gridplus"+(a.__("isRTL")?"-rtl":"")+"'><a href='#'>"+a.__("nextMonth")+"</a></div>").prependTo(a.d.intHTML.find(".ui-datebox-gridheader")).buttonMarkup({theme:d.themeDate,icon:"arrow-r",inline:!0,iconpos:"notext",corners:!0,shadow:!0}).on(d.clickEventAlt,function(b){b.preventDefault();
a.calNext&&(a.theDate.getDate()>28&&a.theDate.setDate(1),a._offset("m",1))});c("<div class='ui-datebox-gridminus"+(a.__("isRTL")?"-rtl":"")+"'><a href='#'>"+a.__("prevMonth")+"</a></div>").prependTo(a.d.intHTML.find(".ui-datebox-gridheader")).buttonMarkup({theme:d.themeDate,icon:"arrow-l",inline:!0,iconpos:"notext",corners:!0,shadow:!0}).on(d.clickEventAlt,function(b){b.preventDefault();a.calPrev&&(a.theDate.getDate()>28&&a.theDate.setDate(1),a._offset("m",-1))});d.calNoHeader===!0&&a.d.intHTML.find(".ui-datebox-gridheader").remove();
b={today:-1,highlightDay:-1,presetDay:-1,startDay:a.__("calStartDay"),thisDate:new a._date,maxDate:a.initDate.copy(),minDate:a.initDate.copy(),currentMonth:!1,weekMode:0,weekDays:null};b.start=(a.theDate.copy([0],[0,0,1]).getDay()-a.__("calStartDay")+7)%7;b.thisMonth=a.theDate.getMonth();b.thisYear=a.theDate.getFullYear();b.wk=a.theDate.copy([0],[0,0,1]).adj(2,-1*b.start+(a.__("calStartDay")===0?1:0)).getWeek(4);b.end=32-a.theDate.copy([0],[0,0,32,13]).getDate();b.lastend=32-a.theDate.copy([0,-1],
[0,0,32,13]).getDate();b.presetDate=a._makeDate(a.d.input.val());b.thisDateArr=b.thisDate.getArray();b.theDateArr=a.theDate.getArray();b.checkDates=c.inArray(!1,[d.afterToday,d.beforeToday,d.notToday,d.maxDays,d.minDays,d.blackDates,d.blackDays])>-1;a.calNext=!0;a.calPrev=!0;if(b.thisDateArr[0]===b.theDateArr[0]&&b.thisDateArr[1]===b.theDateArr[1])b.currentMonth=!0;if(b.presetDate.comp()===a.theDate.comp())b.presetDay=b.presetDate.getDate();if(d.afterToday===!0&&(b.currentMonth===!0||b.thisDateArr[1]>=
b.theDateArr[1]&&b.theDateArr[0]===b.thisDateArr[0]))a.calPrev=!1;if(d.beforeToday===!0&&(b.currentMonth===!0||b.thisDateArr[1]<=b.theDateArr[1]&&b.theDateArr[0]===b.thisDateArr[0]))a.calNext=!1;if(d.minDays!==!1&&(b.minDate.adj(2,-1*d.minDays),b.theDateArr[0]===b.minDate.getFullYear()&&b.theDateArr[1]<=b.minDate.getMonth()))a.calPrev=!1;if(d.maxDays!==!1&&(b.maxDate.adj(2,d.maxDays),b.theDateArr[0]===b.maxDate.getFullYear()&&b.theDateArr[1]>=b.maxDate.getMonth()))a.calNext=!1;if(d.calUsePickers===
!0){b.picker=c("<div>",{"class":"ui-grid-a ui-datebox-grid",style:"padding-top: 5px; padding-bottom: 5px;"});b.picker1=c('<div class="ui-block-a"><select name="pickmon"></select></div>').appendTo(b.picker).find("select");b.picker2=c('<div class="ui-block-b"><select name="pickyar"></select></div>').appendTo(b.picker).find("select");for(f=0;f<=11;f++)b.picker1.append(c('<option value="'+f+'"'+(b.thisMonth===f?' selected="selected"':"")+">"+a.__("monthsOfYear")[f]+"</option>"));for(f=b.thisYear-6;f<=
b.thisYear+6;f++)b.picker2.append(c('<option value="'+f+'"'+(b.thisYear===f?' selected="selected"':"")+">"+f+"</option>"));b.picker1.on("change",function(){a.theDate.setMonth(c(this).val());a.refresh()});b.picker2.on("change",function(){a.theDate.setFullYear(c(this).val());a.refresh()});b.picker.find("select").selectmenu({mini:!0,nativeMenu:!0});b.picker.appendTo(a.d.intHTML)}g=c('<div class="ui-datebox-grid">').appendTo(a.d.intHTML);if(d.calShowDays){a._cal_days=a.__("daysOfWeekShort").concat(a.__("daysOfWeekShort"));
b.weekDays=c("<div>",{"class":"ui-datebox-gridrow"}).appendTo(g);a.__("isRTL")===!0&&b.weekDays.css("direction","rtl");d.calShowWeek&&c("<div>").addClass("ui-datebox-griddate ui-datebox-griddate-empty ui-datebox-griddate-label").appendTo(b.weekDays);for(f=0;f<=6;f++)c("<div>"+a._cal_days[(f+b.startDay)%7]+"</div>").addClass("ui-datebox-griddate ui-datebox-griddate-empty ui-datebox-griddate-label").appendTo(b.weekDays)}b.gen=a._cal_gen(b.start,b.lastend,b.end,!d.calOnlyMonth,a.theDate.getMonth());
f=0;for(var k=b.gen.length;f<k;f++){h=c("<div>",{"class":"ui-datebox-gridrow"});a.__("isRTL")&&h.css("direction","rtl");if(d.calShowWeek&&(c("<div>",{"class":"ui-datebox-griddate ui-datebox-griddate-empty"}).text("W"+b.wk).appendTo(h),b.wk++,b.wk>52&&typeof b.gen[parseInt(f,10)+1]!=="undefined"))b.wk=(new Date(b.theDateArr[0],b.theDateArr[1],a.__("calStartDay")===0?b.gen[parseInt(f,10)+1][1][0]:b.gen[parseInt(f,10)+1][0][0])).getWeek(4);for(var e=0,l=b.gen[f].length;e<l;e++){if(d.calWeekMode)b.weekMode=
b.gen[f][d.calWeekModeDay][0];typeof b.gen[f][e]==="boolean"?c("<div>",{"class":"ui-datebox-griddate ui-datebox-griddate-empty"}).appendTo(h):(i=a._cal_check(b,b.theDateArr[0],b.gen[f][e][1],b.gen[f][e][0]),b.gen[f][e][0]&&c("<div>"+String(b.gen[f][e][0])+"</div>").addClass(b.thisMonth===b.gen[f][e][1]?"ui-datebox-griddate ui-corner-all ui-btn-up-"+i.theme+(i.ok?"":" ui-datebox-griddate-disable"):"ui-datebox-griddate ui-datebox-griddate-empty").jqmData("date",d.calWeekMode?b.weekMode:b.gen[f][e][0]).jqmData("theme",
b.thisMonth===b.gen[f][e][1]?i.theme:"-").jqmData("enabled",i.ok).jqmData("month",b.gen[f][e][1]).appendTo(h))}d.calControlGroup===!0&&h.find(".ui-corner-all").removeClass("ui-corner-all").eq(0).addClass("ui-corner-left").end().last().addClass("ui-corner-right").addClass("ui-controlgroup-last");h.appendTo(g)}d.calShowWeek&&g.find(".ui-datebox-griddate").addClass("ui-datebox-griddate-week");if(d.useTodayButton||d.useClearButton){h=c("<div>",{"class":"ui-datebox-controls"});if(d.useTodayButton)c('<a href="#">'+
a.__("calTodayButtonLabel")+"</a>").appendTo(h).buttonMarkup({theme:d.theme,icon:"check",iconpos:"left",corners:!0,shadow:!0}).on(d.clickEvent,function(b){b.preventDefault();a.theDate=new a._date;a.theDate=new a._date(a.theDate.getFullYear(),a.theDate.getMonth(),a.theDate.getDate(),0,0,0,0);a.d.input.trigger("datebox",{method:"doset"})});if(d.useClearButton)c('<a href="#">'+a.__("clearButton")+"</a>").appendTo(h).buttonMarkup({theme:d.theme,icon:"delete",iconpos:"left",corners:!0,shadow:!0}).on(d.clickEventAlt,
function(b){b.preventDefault();a.d.input.val("");a.d.input.trigger("datebox",{method:"clear"});a.d.input.trigger("datebox",{method:"close"})});d.useCollapsedBut&&h.addClass("ui-datebox-collapse");h.appendTo(g)}a.d.intHTML.on(d.clickEventAlt+" vmouseover vmouseout","div.ui-datebox-griddate",function(b){b.type===d.clickEventAlt?(b.preventDefault(),c(this).jqmData("enabled")&&(a.theDate.set(2,1).set(1,c(this).jqmData("month")).set(2,c(this).jqmData("date")),a.d.input.trigger("datebox",{method:"set",
value:a._formatter(a.__fmt(),a.theDate),date:a.theDate}),a.d.input.trigger("datebox",{method:"close"}))):c(this).jqmData("enabled")&&typeof c(this).jqmData("theme")!=="undefined"&&(d.calWeekMode!==!1&&d.calWeekHigh===!0?c(this).parent().find("div").each(function(){a._hoover(this)}):a._hoover(this))});a.d.intHTML.on("swipeleft",function(){a.calNext&&a._offset("m",1)}).on("swiperight",function(){a.calPrev&&a._offset("m",-1)});if(a.wheelExists)a.d.intHTML.on("mousewheel",function(b,c){b.preventDefault();
c>0&&a.calNext&&(a.theDate.set(2,1),a._offset("m",1));c<0&&a.calPrev&&(a.theDate.set(2,1),a._offset("m",-1))})}})})(jQuery);
