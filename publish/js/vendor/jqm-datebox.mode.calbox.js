(function(d){d.extend(d.mobile.datebox.prototype.options,{themeDateToday:"a",themeDayHigh:"e",themeDatePick:"a",themeDateHigh:"e",themeDateHighAlt:"e",themeDateHighRec:"e",themeDate:"d",calHighToday:!0,calHighPick:!0,calShowDays:!0,calOnlyMonth:!1,calWeekMode:!1,calWeekModeDay:1,calWeekHigh:!1,calControlGroup:!1,calShowWeek:!1,calUsePickers:!1,calNoHeader:!1,useTodayButton:!1,useCollapsedBut:!1,highDays:!1,highDates:!1,highDatesRec:!1,highDatesAlt:!1,enableDates:!1,calDateList:!1,calShowDateList:!1});
d.extend(d.mobile.datebox.prototype,{_cal_gen:function(b,e,d,a,h){for(var c=0,f=0,i=1,k=1,l=[],j=[],m=!1,c=0;c<=5;c++)if(m===!1){j=[];for(f=0;f<=6;f++)c===0&&f<b?a===!0?j.push([e+(f-b)+1,h-1]):j.push(!1):c>3&&i>d?(a===!0?(j.push([k,h+1]),k++):j.push(!1),m=!0):(j.push([i,h]),i++,i>d&&(m=!0));l.push(j)}return l},_cal_check:function(b,e,g,a){var h,c=this.options,f={},i=(new this._date(e,g,a,0,0,0,0)).getDay();f.ok=!0;f.iso=e+"-"+this._zPad(g+1)+"-"+this._zPad(a);f.comp=parseInt(f.iso.replace(/-/g,""),
10);f.theme=c.themeDate;f.recok=!0;f.rectheme=!1;if(c.blackDatesRec!==!1)for(h=0;h<c.blackDatesRec.length;h++)if((c.blackDatesRec[h][0]===-1||c.blackDatesRec[h][0]===e)&&(c.blackDatesRec[h][1]===-1||c.blackDatesRec[h][1]===g)&&(c.blackDatesRec[h][2]===-1||c.blackDatesRec[h][2]===a))f.recok=!1;if(d.isArray(c.enableDates)&&d.inArray(f.iso,c.enableDates)<0)f.ok=!1;else if(b.checkDates&&(f.recok!==!0||c.afterToday===!0&&b.thisDate.comp()>f.comp||c.beforeToday===!0&&b.thisDate.comp()<f.comp||c.notToday===
!0&&b.thisDate.comp()===f.comp||c.maxDays!==!1&&b.maxDate.comp()<f.comp||c.minDays!==!1&&b.minDate.comp()>f.comp||d.isArray(c.blackDays)&&d.inArray(i,c.blackDays)>-1||d.isArray(c.blackDates)&&d.inArray(f.iso,c.blackDates)>-1))f.ok=!1;if(f.ok){if(c.highDatesRec!==!1)for(h=0;h<c.highDatesRec.length;h++)if((c.highDatesRec[h][0]===-1||c.highDatesRec[h][0]===e)&&(c.highDatesRec[h][1]===-1||c.highDatesRec[h][1]===g)&&(c.highDatesRec[h][2]===-1||c.highDatesRec[h][2]===a))f.rectheme=!0;if(c.calHighPick&&
a===b.presetDay&&this.d.input.val()!==""|c.defaultValue!==!1)f.theme=c.themeDatePick;else if(c.calHighToday&&f.comp===b.thisDate.comp())f.theme=c.themeDateToday;else if(d.isArray(c.highDatesAlt)&&d.inArray(f.iso,c.highDatesAlt)>-1)f.theme=c.themeDateHighAlt;else if(d.isArray(c.highDates)&&d.inArray(f.iso,c.highDates)>-1)f.theme=c.themeDateHigh;else if(d.isArray(c.highDays)&&d.inArray(i,c.highDays)>-1)f.theme=c.themeDayHigh;else if(d.isArray(c.highDatesRec)&&f.rectheme===!0)f.theme=c.themeDateHighRec}return f}});
d.extend(d.mobile.datebox.prototype._build,{calbox:function(){var b=this,e=this.options,g,a=!1,h=!1,c=g=!1,f=!1,i=!1;typeof b.d.intHTML!=="boolean"&&b.d.intHTML.remove();b.d.headerText=b._grabLabel()!==!1?b._grabLabel():b.__("titleDateDialogLabel");b.d.intHTML=d("<span>");d('<div class="ui-datebox-gridheader"><div class="ui-datebox-gridlabel"><h4>'+b.__("monthsOfYear")[b.theDate.getMonth()]+" "+b.theDate.getFullYear()+"</h4></div></div>").appendTo(b.d.intHTML);d("<div class='ui-datebox-gridplus"+
(b.__("isRTL")?"-rtl":"")+"'><a href='#'>"+b.__("nextMonth")+"</a></div>").prependTo(b.d.intHTML.find(".ui-datebox-gridheader")).buttonMarkup({theme:e.themeDate,icon:"arrow-r",inline:!0,iconpos:"notext",corners:!0,shadow:!0}).on(e.clickEventAlt,function(a){a.preventDefault();b.calNext&&(b.theDate.getDate()>28&&b.theDate.setDate(1),b._offset("m",1))});d("<div class='ui-datebox-gridminus"+(b.__("isRTL")?"-rtl":"")+"'><a href='#'>"+b.__("prevMonth")+"</a></div>").prependTo(b.d.intHTML.find(".ui-datebox-gridheader")).buttonMarkup({theme:e.themeDate,
icon:"arrow-l",inline:!0,iconpos:"notext",corners:!0,shadow:!0}).on(e.clickEventAlt,function(a){a.preventDefault();b.calPrev&&(b.theDate.getDate()>28&&b.theDate.setDate(1),b._offset("m",-1))});e.calNoHeader===!0&&b.d.intHTML.find(".ui-datebox-gridheader").remove();a={today:-1,highlightDay:-1,presetDay:-1,startDay:b.__("calStartDay"),thisDate:new b._date,maxDate:b.initDate.copy(),minDate:b.initDate.copy(),currentMonth:!1,weekMode:0,weekDays:null};a.start=(b.theDate.copy([0],[0,0,1]).getDay()-b.__("calStartDay")+
7)%7;a.thisMonth=b.theDate.getMonth();a.thisYear=b.theDate.getFullYear();a.wk=b.theDate.copy([0],[0,0,1]).adj(2,-1*a.start+(b.__("calStartDay")===0?1:0)).getWeek(4);a.end=32-b.theDate.copy([0],[0,0,32,13]).getDate();a.lastend=32-b.theDate.copy([0,-1],[0,0,32,13]).getDate();a.presetDate=b.d.input.val()===""?b._startOffset(b._makeDate(b.d.input.val())):b._makeDate(b.d.input.val());a.thisDateArr=a.thisDate.getArray();a.theDateArr=b.theDate.getArray();a.checkDates=d.inArray(!1,[e.afterToday,e.beforeToday,
e.notToday,e.maxDays,e.minDays,e.blackDates,e.blackDays])>-1;b.calNext=!0;b.calPrev=!0;if(a.thisDateArr[0]===a.theDateArr[0]&&a.thisDateArr[1]===a.theDateArr[1])a.currentMonth=!0;if(a.presetDate.comp()===b.theDate.comp())a.presetDay=a.presetDate.getDate();if(e.afterToday===!0&&(a.currentMonth===!0||a.thisDateArr[1]>=a.theDateArr[1]&&a.theDateArr[0]===a.thisDateArr[0]))b.calPrev=!1;if(e.beforeToday===!0&&(a.currentMonth===!0||a.thisDateArr[1]<=a.theDateArr[1]&&a.theDateArr[0]===a.thisDateArr[0]))b.calNext=
!1;if(e.minDays!==!1&&(a.minDate.adj(2,-1*e.minDays),a.theDateArr[0]===a.minDate.getFullYear()&&a.theDateArr[1]<=a.minDate.getMonth()))b.calPrev=!1;if(e.maxDays!==!1&&(a.maxDate.adj(2,e.maxDays),a.theDateArr[0]===a.maxDate.getFullYear()&&a.theDateArr[1]>=a.maxDate.getMonth()))b.calNext=!1;if(e.calUsePickers===!0){a.picker=d("<div>",{"class":"ui-grid-a ui-datebox-grid",style:"padding-top: 5px; padding-bottom: 5px;"});a.picker1=d('<div class="ui-block-a"><select name="pickmon"></select></div>').appendTo(a.picker).find("select");
a.picker2=d('<div class="ui-block-b"><select name="pickyar"></select></div>').appendTo(a.picker).find("select");for(g=0;g<=11;g++)a.picker1.append(d('<option value="'+g+'"'+(a.thisMonth===g?' selected="selected"':"")+">"+b.__("monthsOfYear")[g]+"</option>"));for(g=a.thisYear-6;g<=a.thisYear+6;g++)a.picker2.append(d('<option value="'+g+'"'+(a.thisYear===g?' selected="selected"':"")+">"+g+"</option>"));a.picker1.on("change",function(){b.theDate.setMonth(d(this).val());b.refresh()});a.picker2.on("change",
function(){b.theDate.setFullYear(d(this).val());b.refresh()});a.picker.find("select").selectmenu({mini:!0,nativeMenu:!0});a.picker.appendTo(b.d.intHTML)}h=d('<div class="ui-datebox-grid">').appendTo(b.d.intHTML);if(e.calShowDays){b._cal_days=b.__("daysOfWeekShort").concat(b.__("daysOfWeekShort"));a.weekDays=d("<div>",{"class":"ui-datebox-gridrow"}).appendTo(h);b.__("isRTL")===!0&&a.weekDays.css("direction","rtl");e.calShowWeek&&d("<div>").addClass("ui-datebox-griddate ui-datebox-griddate-empty ui-datebox-griddate-label").appendTo(a.weekDays);
for(g=0;g<=6;g++)d("<div>"+b._cal_days[(g+a.startDay)%7]+"</div>").addClass("ui-datebox-griddate ui-datebox-griddate-empty ui-datebox-griddate-label").appendTo(a.weekDays)}a.gen=b._cal_gen(a.start,a.lastend,a.end,!e.calOnlyMonth,b.theDate.getMonth());g=0;for(var k=a.gen.length;g<k;g++){f=d("<div>",{"class":"ui-datebox-gridrow"});b.__("isRTL")&&f.css("direction","rtl");if(e.calShowWeek&&(d("<div>",{"class":"ui-datebox-griddate ui-datebox-griddate-empty"}).text("W"+a.wk).appendTo(f),a.wk++,a.wk>52&&
typeof a.gen[parseInt(g,10)+1]!=="undefined"))a.wk=(new Date(a.theDateArr[0],a.theDateArr[1],b.__("calStartDay")===0?a.gen[parseInt(g,10)+1][1][0]:a.gen[parseInt(g,10)+1][0][0])).getWeek(4);for(var c=0,l=a.gen[g].length;c<l;c++){if(e.calWeekMode)a.weekMode=a.gen[g][e.calWeekModeDay][0];typeof a.gen[g][c]==="boolean"?d("<div>",{"class":"ui-datebox-griddate ui-datebox-griddate-empty"}).appendTo(f):(i=b._cal_check(a,a.theDateArr[0],a.gen[g][c][1],a.gen[g][c][0]),a.gen[g][c][0]&&d("<div>"+String(a.gen[g][c][0])+
"</div>").addClass(a.thisMonth===a.gen[g][c][1]?"ui-datebox-griddate ui-corner-all ui-btn-up-"+i.theme+(i.ok?"":" ui-datebox-griddate-disable"):"ui-datebox-griddate ui-datebox-griddate-empty").jqmData("date",e.calWeekMode?a.weekMode:a.gen[g][c][0]).jqmData("theme",a.thisMonth===a.gen[g][c][1]?i.theme:"-").jqmData("enabled",i.ok).jqmData("month",a.gen[g][e.calWeekMode?e.calWeekModeDay:c][1]).appendTo(f))}e.calControlGroup===!0&&f.find(".ui-corner-all").removeClass("ui-corner-all").eq(0).addClass("ui-corner-left").end().last().addClass("ui-corner-right").addClass("ui-controlgroup-last");
f.appendTo(h)}e.calShowWeek&&h.find(".ui-datebox-griddate").addClass("ui-datebox-griddate-week");if(e.calShowDateList===!0&&e.calDateList!==!1){a.datelist=d("<div>");a.datelistpick=d('<select name="pickdate"></select>').appendTo(a.datelist);a.datelistpick.append('<option value="false" selected="selected">'+b.__("calDateListLabel")+"</option>");for(g=0;g<e.calDateList.length;g++)a.datelistpick.append(d('<option value="'+e.calDateList[g][0]+'">'+e.calDateList[g][1]+"</option>"));a.datelistpick.on("change",
function(){a.datelistdate=d(this).val().split("-");b.theDate=new b._date(a.datelistdate[0],a.datelistdate[1]-1,a.datelistdate[2],0,0,0,0);b.d.input.trigger("datebox",{method:"doset"})});a.datelist.find("select").selectmenu({mini:!0,nativeMenu:!0});a.datelist.appendTo(b.d.intHTML)}if(e.useTodayButton||e.useClearButton){f=d("<div>",{"class":"ui-datebox-controls"});if(e.useTodayButton)d('<a href="#">'+b.__("calTodayButtonLabel")+"</a>").appendTo(f).buttonMarkup({theme:e.theme,icon:"check",iconpos:"left",
corners:!0,shadow:!0}).on(e.clickEvent,function(a){a.preventDefault();b.theDate=new b._date;b.theDate=new b._date(b.theDate.getFullYear(),b.theDate.getMonth(),b.theDate.getDate(),0,0,0,0);b.d.input.trigger("datebox",{method:"doset"})});if(e.useClearButton)d('<a href="#">'+b.__("clearButton")+"</a>").appendTo(f).buttonMarkup({theme:e.theme,icon:"delete",iconpos:"left",corners:!0,shadow:!0}).on(e.clickEventAlt,function(a){a.preventDefault();b.d.input.val("");b.d.input.trigger("datebox",{method:"clear"});
b.d.input.trigger("datebox",{method:"close"})});e.useCollapsedBut&&f.addClass("ui-datebox-collapse");f.appendTo(h)}b.d.intHTML.on(e.clickEventAlt+" vmouseover vmouseout","div.ui-datebox-griddate",function(a){a.type===e.clickEventAlt?(a.preventDefault(),d(this).jqmData("enabled")&&(b.theDate.set(2,1).set(1,d(this).jqmData("month")).set(2,d(this).jqmData("date")),b.d.input.trigger("datebox",{method:"set",value:b._formatter(b.__fmt(),b.theDate),date:b.theDate}),b.d.input.trigger("datebox",{method:"close"}))):
d(this).jqmData("enabled")&&typeof d(this).jqmData("theme")!=="undefined"&&(e.calWeekMode!==!1&&e.calWeekHigh===!0?d(this).parent().find("div").each(function(){b._hoover(this)}):b._hoover(this))});b.d.intHTML.on("swipeleft",function(){b.calNext&&b._offset("m",1)}).on("swiperight",function(){b.calPrev&&b._offset("m",-1)});if(b.wheelExists)b.d.intHTML.on("mousewheel",function(a,c){a.preventDefault();c>0&&b.calNext&&(b.theDate.set(2,1),b._offset("m",1));c<0&&b.calPrev&&(b.theDate.set(2,1),b._offset("m",
-1))})}})})(jQuery);
