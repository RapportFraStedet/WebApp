OpenLayers.Control.MapGuideGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{maxFeatures:10,clickCallback:"click",layer:null,persist:1,layerAttributeFilter:3,url:null,handlerOptions:null,handler:null,initialize:function(a){a=a||{};a.handlerOptions=a.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[a]);a={};a[this.clickCallback]=this.getInfoForClick;this.handler=new OpenLayers.Handler.Click(this,a,this.handlerOptions.click||{})},getInfoForClick:function(a){this.events.triggerEvent("beforegetfeatureinfo",
{xy:a.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(a.xy,{})},request:function(a){this.map.getProjection();var b=this.layer.projection;b&&b.equals(this.map.getProjectionObject())&&b.getCode();var b=this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.x,a.y)),c=this.map.getResolution()*30,d={version:"1.0.0",locale:"en",clientagent:"rapport fra stedet",operation:"QUERYMAPFEATURES",session:this.layer.params.session,mapname:this.layer.params.mapname,geometry:OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(b.lon,
b.lat),c,4,0).toString(),maxFeatures:-1,persist:1,selectionVariant:"INTERSECTS",layerAttributeFilter:3};redline.addFeatures([new OpenLayers.Feature.Vector(OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(b.lon,b.lat),c,4,0))]);OpenLayers.Request.GET({url:this.url,params:d,callback:function(b){OpenLayers.ProxyHost=null;this.handleResponse(a,b,url)},scope:this})},triggerGetFeatureInfo:function(a,b,c){this.events.triggerEvent("getfeatureinfo",{text:a.responseText,features:c,
request:a,xy:b});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(a,b){var c="",d=b.responseXML;if(d&&d.documentElement)for(var e=0;e<d.documentElement.childNodes.length;e++){var f=d.documentElement.childNodes[e];f.nodeName=="Property"&&(c+="<li>"+f.attributes.name.value+": "+f.attributes.value.value+"</li>")}c!=""&&($("#infolist").empty().append(c).listview("refresh"),$("#info").popup("open"))},CLASS_NAME:"OpenLayers.Control.MapGuideGetFeatureInfo"});
