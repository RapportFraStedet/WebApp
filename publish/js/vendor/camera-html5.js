function uploadCamera(){if(window.FormData){var a=$("#rapportForm")[0],b=new FormData(a);$(".imageCamera").each(function(){var a=this.id.replace("A","");b.append(a,this.src)});$(".current > span").hasClass("animate")&&$(".current > span").removeClass("animate");a=new XMLHttpRequest;a.open("POST",Rfs.url+"/api/SaveFormsData.aspx",!0);a.onerror=function(){alert("error")};a.onload=function(){$(".current > span").width("100%");if(this.status==200)$.mobile.changePage("#Kvittering",{transition:"slide"});
else{var a=JSON.parse(this.response);$("#errorMessage").html("<h3>"+a.Message+"</h3><p>"+a.ExceptionMessage+"</p>");$.mobile.changePage("#KvitteringError",{transition:"slide"})}};a.upload.onprogress=function(a){a.lengthComputable&&$(".current > span").width(a.loaded/a.total*100+"%")};a.send(b)}else $(".imageCamera").each(function(){var a=this.id.replace("A",""),b=$("#"+a);b.length>0?b.val(this.src):$("#rapportForm").append("<input type='hidden' name='"+a+"' id='"+a+"' value='"+this.src+"'/>")}),a=
$("#rapportForm")[0],a.action=Rfs.url+"/api/SaveFormsData.aspx",a.method="post",a.enctype="multipart/form-data",a.target="hiddenIFrame",a.submit(),$(".current > span").width("100%"),$(".current > span").hasClass("animate")||$(".current > span").addClass("animate"),$.mobile.changePage("#Kvittering")}var stream=null;
function markupCamera(a){var b="<div data-role='fieldcontain'>";b+="<label for='"+a.Id+"' class='ui-input-text'>";a.Required==1&&(b+="<em>*</em>");b+=a.Name+"</label><div class='cameraButtons'>";html5File()&&(b+="<div data-role='button' data-inline='true'",a.Permission==1&&(b+=" class='ui-disabled'"),b+=">Fotoalbum<input class='fotoselect' type='file' name='"+a.Id+"' /></div>");html5Camera()&&(b+="<a href='#PhotoPage?id="+a.Id+"' data-role='button' data-inline='true' data-transition='slide'",a.Permission==
1&&(b+=" class='ui-disabled'"),b+=">Kamera</a>");b+="<img id='A"+a.Id+"' width='100%' style='display: none;'/>";b+="</div></div>";return b}
$("#PhotoPage").live("pageshow",function(){var a=$(window).height(),b=$("#PhotoPage").children(":jqmData(role=content)"),c=a;b.outerHeight()!==a&&(c-=b.outerHeight()-b.height(),$("#Photo").css("height",c));a=$("#photoButton");b=$(window).width();c=a.outerWidth();a.css("left",(b-c)/2);window.URL=window.URL||window.webkitURL;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;navigator.getUserMedia({video:!0},function(a){var b=
document.querySelector("video");b.src=window.URL.createObjectURL(a);stream=a;b.onloadedmetadata=function(){}},function(a){console.log("Reeeejected!",a)})});
function snapshot(){if(stream){var a=document.querySelector("video"),b=document.querySelector("canvas");b.width=a.videoWidth;b.height=a.videoHeight;b.getContext("2d").drawImage(a,0,0);a=$("#"+imageId);a.length>0&&a.val("");$("#A"+imageId).attr("src",b.toDataURL("image/jpeg")).css("display","inline").addClass("imageCamera");b=$("input[name='"+imageId+"']");if(b.length>0)b.unbind("change"),b[0].outerHTML=b[0].outerHTML,$("input[name='"+imageId+"']").bind("change",Rfs.inputChanged)}$.mobile.changePage("#Formular",
{transition:"slide",reverse:!0})};
