(!window.console||!console.log)&&function(){for(var c=function(){},a="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,markTimeline,table,time,timeEnd,timeStamp,trace,warn".split(","),b=a.length,d=window.console={};b--;)d[a[b]]=c}();
Modernizr.load({test:Modernizr.inputtypes.date,yep:"js/vendor/date.js",nope:["css/jqm-datebox.css","js/vendor/jqm-datebox.core.js","js/vendor/jqm-datebox.mode.calbox.js","js/vendor/jquery.mobile.datebox.i18n.da.utf8.js","js/vendor/no-date.js"]});function html5Camera(){return!(!navigator.getUserMedia&&!navigator.webkitGetUserMedia&&!navigator.mozGetUserMedia&&!navigator.msGetUserMedia)}function html5File(){return window.File&&window.FileReader&&window.FileList&&window.Blob}
typeof cordova!="undefined"?Modernizr.load({load:"js/vendor/camera-cordova.js"}):html5File()||html5Camera()?Modernizr.load({load:"js/vendor/camera-html5.js"}):Modernizr.load({load:"js/vendor/camera.js"});
var url="http://service.rapportfrastedet.dk/RapportFraStedet/api/kommune.aspx",imageId,x=0,y=0,vent=1E4,formularInit=!1;
$(document).on("pageshow",function(c){try{var a="",d=!1;switch(c.target.id){case "AlleKommuner":document.title="Alle Kommuner";d=!0;Rfs.showAlleKommuner();a=location.href;break;case "Kommune":document.title=Rfs.kommune.Navn;d=!0;Rfs.showThemes();a=location.href;break;case "Tema":reverse?reverse=!1:(Rfs.showKort(),window.map||(initMap(),fixContentHeight()));document.title=Rfs.kommune.Navn+" - "+Rfs.tema.Navn+" - Kort";d=!0;a=location.href;break;case "Formular":document.title=Rfs.kommune.Navn+" - "+
Rfs.tema.Navn;d=!0;a=location.href;break;case "PhotoPage":document.title=Rfs.kommune.Navn+" - "+Rfs.tema.Navn+" - Kamera";d=!0;a=location.href;break;case "Progress":uploadCamera();break;case "Start":document.title="Rapport Fra Stedet";a="";d=!0;break;case "Advarsel":document.title=Rfs.kommune.Navn+" - Advarsel";a="#Advarsel";d=!0;break;case "Kvittering":document.title=Rfs.kommune.Navn+" - "+Rfs.tema.Navn+" - Kvittering",a="#Kvittering",d=!0}d&&(_gaq.push(["_setAccount","UA-24623853-2"]),_gaq.push(["_trackPageview",
a]))}catch(b){}});var reverse=!1;Path.map("#/kommuner").to(function(){var c={dataUrl:location.toString(),changeHash:!1,transition:"slide",reverse:reverse};reverse=!1;$.mobile.changePage($("#AlleKommuner"),c)});Path.map("#/kommuner/fejl").to(function(){var c={dataUrl:location.toString(),changeHash:!1,transition:"slide"};$.mobile.changePage($("#ShowKommunerError"),c)});
Path.map("#/kommune/:kommuneId").to(function(){var c={dataUrl:location.toString(),changeHash:!1,transition:"slide",reverse:reverse};reverse=!1;Rfs.showKommune(this.params.kommuneId,c)});Path.map("#/kommune/:kommuneId/dialog").to(function(){var c={dataUrl:location.toString(),changeHash:!1};$.mobile.changePage($("#ModtagerIkkeIndberetning"),c)});
Path.map("#/kommune/:kommuneId/warning").to(function(){var c={dataUrl:location.toString(),changeHash:!1,transition:"slide"};$.mobile.changePage($("#Warning"),c)});
Path.map("#/kommune/:kommuneId/advarsel").to(function(){var c={dataUrl:location.toString(),changeHash:!1,transition:"slide"};if(Rfs.kommuner!=null)for(var a=0;a<Rfs.kommuner.length;a++)if(Rfs.kommuner[a].Nr==this.params.kommuneId){Rfs.kommune=Rfs.kommuner[a];break}if(Rfs.kommune!=null){var a=$("#Advarsel"),d="";d+="<h2>"+Rfs.kommune.Navn+" Kommune</h2>";d+="<p>Rapport Fra Stedet kan ikke indberette til denne kommune!</p>";Rfs.kommune.Besked!=""&&(d+="<p>"+Rfs.kommune.Besked+"</p>");Rfs.kommune.URL!=
""&&(d+="<a href='"+Rfs.kommune.URL+"' rel='external' data-ajax='false' data-role='button'>Kontakt</a>");d+="<p>Du kan v\u00e6lge at indberette til en anden kommune.</p>";d+="<a onclick='backToKommuner()' data-role='button' data-theme='b' >V\u00e6lg kommune</a>";$("#update").html(d);a.trigger("create")}$.mobile.changePage($("#Advarsel"),c)});
Path.map("#/kommune/:kommuneId/:temaId").to(function(){var c={dataUrl:location.toString(),changeHash:!1,transition:"slide",reverse:reverse},a=this.params.kommuneId,d=this.params.temaId;if(reverse&&Rfs.tema!=null)$.mobile.changePage($("#Tema"),c);else if(Rfs.rapport=null,Rfs.kommune&&Rfs.kommune.Nr==a)if(Rfs.tema&&Rfs.tema.Id==d)$.mobile.changePage($("#Tema"),c);else{Rfs.tema=null;if(Rfs.temaer!=null)for(var b=0;b<Rfs.temaer.length;b++)if(Rfs.temaer[b].Id==d&&Rfs.temaer[b].Nr==a){Rfs.tema=Rfs.temaer[b];
break}Rfs.tema==null?($.mobile.showPageLoadingMsg("a","Henter tema...",!1),$.ajax({url:Rfs.kommune.URL+"/api/Tema.aspx",dataType:"jsonp",timeout:vent,data:{nr:a,id:d},success:function(b){Rfs.tema=b;$.mobile.activePage.selector=="#Tema"?reverse?reverse=!1:(Rfs.showKort(),window.map||(initMap(),fixContentHeight())):$.mobile.changePage($("#Tema"),c)},error:function(){location.hash="#/kommune/"+a+"/"+d+"/fejl"},complete:function(){$.mobile.hidePageLoadingMsg()}})):$.mobile.changePage($("#Tema"),c)}else{if(Rfs.kommuner!=
null)for(b=0;b<Rfs.kommuner.length;b++)if(Rfs.kommuner[b].Nr==a){Rfs.kommune=Rfs.kommuner[b];break}Rfs.kommune==null?($.mobile.showPageLoadingMsg("a","Henter kommune...",!1),$.ajax({url:url,dataType:"jsonp",timeout:vent,data:{nr:a},success:function(b){Rfs.kommune=b;$.mobile.showPageLoadingMsg("a","Henter tema...",!1);$.ajax({url:Rfs.kommune.URL+"/api/Tema.aspx",dataType:"jsonp",timeout:vent,data:{nr:a,id:d},success:function(b){Rfs.tema=b;$.mobile.changePage($("#Tema"),c)},error:function(){location.hash=
"#/kommune/"+a+"/"+d+"/fejl"},complete:function(){$.mobile.hidePageLoadingMsg()}})},error:function(){location.hash="#/kommune/"+a+"/"+d+"/fejl"},complete:function(){$.mobile.hidePageLoadingMsg()}})):$.mobile.changePage($("#Tema"),c)}});Path.map("#/kommune/:kommuneId/:temaId/kamera/:imageId").to(function(){imageId=this.params.imageId;var c={dataUrl:location.toString(),changeHash:!1,transition:"slide"};$.mobile.changePage($("#PhotoPage"),c)});
Path.map("#/kommune/:kommuneId/:temaId/fejl").to(function(){var c={dataUrl:location.toString(),changeHash:!1,transition:"slide",reverse:reverse};reverse=!1;$.mobile.changePage($("#ShowKortError"),c)});Path.map("#/kommune/:kommuneId/:temaId/find1").to(function(){var c={dataUrl:location.toString(),changeHash:!1,transition:"slide",reverse:reverse};reverse=!1;$.mobile.changePage($("#SearchPage1"),c)});
Path.map("#/kommune/:kommuneId/:temaId/find2").to(function(){var c={dataUrl:location.toString(),changeHash:!1,transition:"slide",reverse:reverse};reverse=!1;$.mobile.changePage($("#SearchPage2"),c)});Path.map("#/kommune/:kommuneId/:temaId/find3").to(function(){var c={dataUrl:location.toString(),changeHash:!1,transition:"slide",reverse:reverse};reverse=!1;$.mobile.changePage($("#SearchPage3"),c)});
Path.map("#/kommune/:kommuneId/:temaId/formular").to(function(){var c={dataUrl:location.toString(),changeHash:!1,transition:"slide",reverse:reverse};reverse=!1;$.mobile.changePage($("#Formular"),c)});Path.map("#/kommune/:kommuneId/:temaId/progress").to(function(){var c={dataUrl:location.toString(),changeHash:!1,transition:"slide"};$.mobile.changePage($("#Progress"),c)});
Path.map("#/kommune/:kommuneId/:temaId/kvittering").to(function(){$("#kvitteringTekst").html(Rfs.kvittering);var c={dataUrl:location.toString(),changeHash:!1,transition:"slide"};$.mobile.changePage($("#Kvittering"),c)});Path.map("#/Start").to(function(){$.mobile.changePage($("#Start"),{dataUrl:"",changeHash:!1})});Path.root("#/Start");function showTegn(){$("#Tegn").popup("open")}function showLayers(){$("#layerspage").popup("open")}
function showProgress(){location="#/kommune/"+Rfs.kommune.Nr+"/"+Rfs.tema.Id+"/progress"}function backToKommuner(){reverse=!0;location="#/kommuner"}function backToKommune(){reverse=!0;location="#/kommune/"+Rfs.kommune.Nr}function backToFormular(){reverse=!0;location="#/kommune/"+Rfs.kommune.Nr+"/"+Rfs.tema.Id+"/formular"}function backToMap(){reverse=!0;location="#/kommune/"+Rfs.kommune.Nr+"/"+Rfs.tema.Id}
function backToSearch(c){reverse=!0;location="#/kommune/"+Rfs.kommune.Nr+"/"+Rfs.tema.Id+"/find"+c}$(function(){$.mobile.initializePage();Path.listen();$(window).bind("resize orientationchange",function(){fixContentHeight()});$.support.cors=!0});
function geoLocate(){x!=0&&y!=0?Rfs.showPosition():navigator.geolocation?($.mobile.showPageLoadingMsg("a","Finder position...",!1),navigator.geolocation.getCurrentPosition(function(c){$.mobile.hidePageLoadingMsg();x=c.coords.longitude;y=c.coords.latitude;Rfs.lat=c.coords.latitude;Rfs.lon=c.coords.longitude;Rfs.acc=c.coords.accuracy;var c=new Proj4js.Proj("EPSG:4326"),a=new Proj4js.Proj("EPSG:25832"),d=new Proj4js.Point(x,y);Proj4js.transform(c,a,d);x=d.x;y=d.y;Rfs.showPosition()},function(){$.mobile.hidePageLoadingMsg();
location.hash="#/kommuner"},{enableHighAccuracy:!0,maximumAge:0,timeout:6E4})):location.hash="#/kommuner"}
$(document).bind("pageinit",function(c){switch(c.target.id){case "SearchPage1":$("#search1").bind("keyup change",function(){var a=$(this).val();oiorest.search(a)});break;case "Start":$("#app").length>0&&(c=navigator.userAgent.toLowerCase(),c.indexOf("android")>-1?$("#app").html("<p>Installere Rapport Fra Stedet som app p\u00e5 din smartphone. Klik p\u00e5 nedenst\u00e5ende link.</p><a rel='external' data-ajax='false' href='http://www.rapportfrastedet.dk/RapportFraStedet.apk' ><img src='./img/android.png' alt='Android'/></a>"):(c.indexOf("ipad")>
-1||c.indexOf("iphone")>-1)&&$("#app").html("<p>Installere Rapport Fra Stedet som app p\u00e5 din smartphone. Klik p\u00e5 nedenst\u00e5ende link.</p><a rel='external' data-ajax='false' href='http://itunes.com/apps/rfs' ><img src='./img/apple.png' alt='Apple'/></a>"));break;case "Formular":formularInit=!0,$("#rapportForm").submit(function(){return!1})}});
var Rfs={url:null,mapSet:null,temaer:null,tema:null,rapport:null,kommuner:null,kommune:null,useDrawControl:!1,showMarker:!1,showInfo:!1,lat:0,lon:0,acc:0,ajaxCheck:null,init:function(){$("#Kommune").page();$("#AlleKommuner").page();$("#Formular").page();$("#Advarsel").page();$("#Tema").page()},showAlleKommuner:function(){Rfs.kommuner==null&&($.mobile.showPageLoadingMsg("a","Henter kommuner...",!1),$.ajax({url:url,dataType:"jsonp",timeout:vent,success:function(c){Rfs.kommuner=c;Rfs.kommune=null;Rfs.tema=
null;Rfs.temaer=null;for(var a="",d=0;d<c.length;d++){var b=c[d];a+="<li";b.ModtagerIndberetning==0?(a+=" data-icon='alert'>",a+="<a href='#/kommune/"+b.Nr+"/advarsel' >"):a+="><a href='#/kommune/"+b.Nr+"'>";b.Logo!=""&&(a+="<img src='http://service.rapportfrastedet.dk/RapportFraStedet/Images/Kommuner/"+b.Logo+"' />");a+="<h1>"+b.Navn+"</h1>";b.ModtagerIndberetning==0&&(a+="<a href='#/kommune/"+b.Nr+"/advarsel' data-theme='e'></a>");a+="</a></li>"}c=$("#AlleKommuner").children(":jqmData(role=content)");
c.find("ul").html(a);c.find("ul").listview("refresh")},error:function(){location.hash="#/kommuner/fejl"},complete:function(){$.mobile.hidePageLoadingMsg()}}))},showKommune:function(c,a){if(Rfs.kommune&&Rfs.kommune.Nr==c)$.mobile.changePage($("#Kommune"),a);else{Rfs.temaer=null;if(Rfs.kommuner!=null)for(var d=0;d<Rfs.kommuner.length;d++)if(Rfs.kommuner[d].Nr==c){Rfs.kommune=Rfs.kommuner[d];break}Rfs.kommune==null?($.mobile.showPageLoadingMsg("a","Henter kommune...",!1),$.ajax({url:url,dataType:"jsonp",
timeout:vent,data:{nr:c},success:function(b){Rfs.kommune=b;$.mobile.changePage($("#Kommune"),a)},error:function(){location.hash="#/kommune/"+c+"/fejl"},complete:function(){$.mobile.hidePageLoadingMsg()}})):$.mobile.changePage($("#Kommune"),a)}},showThemes:function(){Rfs.tema=null;if(!Rfs.temaer)if(Rfs.kommune.ModtagerIndberetning)$.mobile.showPageLoadingMsg("a","Henter temaer...",!1),$.ajax({url:Rfs.kommune.URL+"/api/Tema.aspx",dataType:"jsonp",timeout:vent,data:{nr:Rfs.kommune.Nr,x:x,y:y},success:function(b){Rfs.createKommune(b)},
error:function(){location.hash="#/kommune/"+Rfs.kommune.Nr+"/fejl"},complete:function(){$.mobile.hidePageLoadingMsg()}});else{var c=$("#ModtagerIkkeIndberetning"),a=c.children(":jqmData(role=content)"),d="";d+="<h2>Du st\u00e5r i "+Rfs.kommune.Navn+" Kommune</h2>";d+="<p>RapportFraStedet kan ikke indberette til denne kommune!</p>";Rfs.kommune.Besked!=""&&(d+="<p>"+Rfs.kommune.Besked+"</p>");Rfs.kommune.URL!=""&&(d+="<a href='"+Rfs.kommune.URL+"' rel='external' data-ajax='false' data-role='button'>Kontakt</a>");
d+="<p>Du kan v\u00e6lge at indberette til en anden kommune.</p>";d+="<a href='#/kommuner' data-role='button' data-theme='b' >V\u00e6lg kommune</a>";a.html(d);c.trigger("create");location.hash="#/kommune/"+Rfs.kommune.Nr+"/dialog"}},createKommune:function(c){Rfs.temaer=c;var c=$("#Kommune"),a=c.children(":jqmData(role=header)"),d="",d=a.find("img");d[0].src="http://service.rapportfrastedet.dk/RapportFraStedet/Images/Kommuner/"+Rfs.kommune.Logo;d[0].style.visibility=Rfs.kommune.Logo==""?"hidden":"visible";
a.find("h1").html(Rfs.kommune.Navn+" Kommune");d="";for(a=0;a<Rfs.temaer.length;a++){var b=Rfs.temaer[a];d+="<li";b.ModtagerIndberetning==0&&(d+=" data-icon='alert'");d+="><a href='#/kommune/"+Rfs.kommune.Nr+"/"+b.Id+"' data-transition='slide'>";b.Logo!=""&&(d+="<img src='"+b.Logo+"' />");d+="<h1>"+b.Navn+"</h1><p>"+b.Beskrivelse+"</p>";b.ModtagerIndberetning==0&&(d+="<a href='#/kommune/"+Rfs.kommune.Nr+"/warning' data-theme='e' data-rel='dialog' data-transition='slide'></a>");d+="</a></li>"}a=c.children(":jqmData(role=content)");
a.find("ul").html(d);a.find("ul").listview("refresh");c.page()},showKort:function(){$.mobile.showPageLoadingMsg("a","Henter kort...",!1);$("#tegnList").html("<li data-role='divider' data-theme='a'>Tegnev\u00e6rkt\u00f8jer</li>");var c=Rfs.tema.MapAgent.toLowerCase().replace("mapagent/mapagent.fcgi","fusion")+"/layers/mapguide/php/ApplicationDefinition.php?USERNAME=Anonymous&CLIENTAGENT=Rapport+Fra+Stedet+1.0.0&appid="+Rfs.tema.ApplicationDefinition;$.ajax({url:c,dataType:"jsonp",timeout:vent,complete:function(){$.mobile.hidePageLoadingMsg()},
error:function(){location.hash="#/kommune/"+Rfs.kommune.Nr+"/"+Rfs.tema.Id+"/fejl"},success:function(a){Rfs.useDrawControl=!1;Rfs.showMarker=!1;Rfs.url=null;Rfs.FeatureInfo=!1;Rfs.kvittering="<h3>Tak for din indberetning</h3><p>Vil du foretage en ny indberetning?</p>";$("#kortnavbar").hide();$("#backKommune").attr("href","#/kommune/"+Rfs.kommune.Nr);if(a.ApplicationDefinition&&a.ApplicationDefinition.length>0&&a.ApplicationDefinition[0].MapSet&&a.ApplicationDefinition[0].MapSet.length>0){Rfs.mapSet=
a.ApplicationDefinition[0].MapSet[0];oiorest.init();if(a.ApplicationDefinition[0].WidgetSet&&a.ApplicationDefinition[0].WidgetSet.length>0){for(widget in a.ApplicationDefinition[0].WidgetSet[0].Widget){var c=a.ApplicationDefinition[0].WidgetSet[0].Widget[widget];switch(c.Type[0]){case "RfsSearch":var b=c.Extension[0],e=new Search(widget,c.Name[0],c.Disabled[0]=="false");e.placeholder1=b.placeholder1[0];e.url1=b.url1[0].replace(/%26/gi,"&");e.id1=b.id1[0];e.name1=b.name1[0];e.chars1=b.chars1[0];e.title1=
b.title1[0];if(b.placeholder2)e.placeholder2=b.placeholder2[0];if(b.url2)e.url2=b.url2[0].replace(/%26/gi,"&");if(b.id2)e.id2=b.id2[0];if(b.name2)e.name2=b.name2[0];if(b.chars2)e.chars2=b.chars2[0];if(b.title2)e.title2=b.title2[0];if(b.placeholder3)e.placeholder3=b.placeholder3[0];if(b.url3)e.url3=b.url3[0].replace(/%26/gi,"&");if(b.id3)e.id3=b.id3[0];if(b.name3)e.name3=b.name3[0];if(b.chars3)e.chars3=b.chars3[0];if(b.title3)e.title3=b.title3[0];e.url=b.url[0].replace(/%26/gi,"&");e.x1=b.x1[0];e.y1=
b.y1[0];e.projection=b.projection[0];oiorest.items.push(e);break;case "RapportFraStedet":$("#kortnavbar").show();b=c.Extension[0];if(b.kvittering)Rfs.kvittering=b.kvittering[0];if(b.type[0]!="-1"&&b.type[0]!="0")$("#tegnList").html("<li data-role='divider' data-theme='a'>Tegnev\u00e6rkt\u00f8jer</li>"),Rfs.useDrawControl=!0;if(b.type[0]=="0")Rfs.showMarker=!0;(b.type[0]=="1"||b.type[0]=="3"||b.type[0]=="5"||b.type[0]=="7")&&$("<li id='tegnPunkt' data-icon='check'><a href='#' data-rel='back' onclick='Point()'>Punkt</a></li>").appendTo("#tegnList");
(b.type[0]=="2"||b.type[0]=="3"||b.type[0]=="6"||b.type[0]=="7")&&$("<li id='tegnLinie' data-icon='check'><a href='#' data-rel='back' onclick='Line()'>Linie</a></li>").appendTo("#tegnList");(b.type[0]=="4"||b.type[0]=="5"||b.type[0]=="6"||b.type[0]=="7")&&$("<li id='tegnPolygon' data-icon='check'><a href='#' data-rel='back' onclick='Polygon()'>Polygon</a></li>").appendTo("#tegnList");b.type[0]!="-1"&&b.type[0]!="0"&&($("<li id='tegnRediger' data-icon='check'><a href='#' data-rel='back' onclick='Modify()'>Rediger</a></li>").appendTo("#tegnList"),
$("<li id='tegnNaviger' data-icon='check' class='checked'><a href='#' data-rel='back' onclick='Navigate()'>Naviger</a></li>").appendTo("#tegnList"),$("#tegnList").listview("refresh"));if(b.Url)Rfs.url=b.Url[0];break;case "FeatureInfo":Rfs.FeatureInfo=!0}}$("#Tema");a=$("#headerKort").html("");$("<a data-role='button' data-mini='true' data-corners='false' data-iconpos='top' class='ui-block-a' data-theme='a' data-icon='locate' onclick='locate()' >Position</a>").button().appendTo(a);oiorest.items.length>
0?($("<a data-role='button' data-mini='true' data-corners='false' data-iconpos='top' class='ui-block-b' data-theme='a' href='#/kommune/"+Rfs.kommune.Nr+"/"+Rfs.tema.Id+"/find1' data-icon='search' >S\u00f8g</a>").button().appendTo(a),Rfs.useDrawControl?($("<a onclick='showTegn()' data-role='button' data-mini='true' data-corners='false' data-iconpos='top' class='ui-block-c' data-theme='a' data-icon='star' >Tegn</a>").button().appendTo(a),$("<a onclick='showLayers()' data-role='button' data-mini='true' data-corners='false' data-iconpos='top' class='ui-block-d' data-theme='a' data-icon='layers' >Kort</a>").button().appendTo(a),
a.removeClass("ui-grid-a"),a.removeClass("ui-grid-b"),a.addClass("ui-grid-c")):($("<a onclick='showLayers()' data-role='button' data-mini='true' data-corners='false' data-iconpos='top' class='ui-block-c' data-theme='a' data-icon='layers' >Kort</a>").button().appendTo(a),a.removeClass("ui-grid-a"),a.removeClass("ui-grid-c"),a.addClass("ui-grid-b"))):Rfs.useDrawControl?($("<a onclick='showTegn()' data-theme='a' data-role='button' data-mini='true' data-corners='false' data-iconpos='top' class='ui-block-c' data-icon='star'>Tegn</a>").button().appendTo(a),
$("<a onclick='showLayers()' data-theme='a' data-role='button' data-mini='true' data-corners='false' data-iconpos='top' class='ui-block-d' data-icon='layers' >Kort</a>").button().appendTo(a),a.removeClass("ui-grid-a"),a.removeClass("ui-grid-c"),a.addClass("ui-grid-b")):($("<a onclick='showLayers()' data-theme='a' data-role='button' data-mini='true' data-corners='false' data-iconpos='top' class='ui-block-c'  data-icon='layers' >Kort</a>").button().appendTo(a),a.removeClass("ui-grid-b"),a.removeClass("ui-grid-c"),
a.addClass("ui-grid-a"));if(oiorest.items.length>1){$("#searchOptionsDiv").html("<fieldset id='searchOptions' data-role='controlgroup'><legend>S\u00f8gemuligheder</legend></fieldset>");for(e in oiorest.items)oiorest.items[e].createCheckBox();$("#SearchPage1").trigger("create")}else $("#searchOptionsDiv").html("")}fixContentHeight();Rfs.url?(e=Rfs.url.replace("Data.aspx/Index","api/DataApi.aspx"),Rfs.url=Rfs.url.substr(0,Rfs.url.indexOf("/Data.aspx/Index")),$.mobile.showPageLoadingMsg("a","Henter formular...",
!1),$.ajax({url:e,dataType:"jsonp",success:function(b){Rfs.createform(b)},error:function(){location.hash="#/kommune/"+Rfs.kommune.Nr+"/"+Rfs.tema.Id+"/fejl"},complete:function(){$.mobile.hidePageLoadingMsg()}})):createMap()}}})},createform:function(c){Rfs.rapport=c;var c=c.Felter,a=$("#Formular").children(":jqmData(role=header)"),d=a.find("img");d[0].src=Rfs.tema.Logo;d[0].style.visibility=Rfs.tema.Logo==""?"hidden":"visible";a.find("h1").html(Rfs.tema.Navn);a="<input type='hidden' name='FormId' value='"+
Rfs.rapport.FormId+"'/>";a+="<input type='hidden' name='UniqueId' value='"+Rfs.rapport.UniqueId+"'/>";a+="<input type='hidden' name='ItemId' value='"+Rfs.rapport.ItemId+"'/>";a+="<input type='hidden' name='ViewId' value='"+Rfs.rapport.ViewId+"'/>";a+="<input type='hidden' name='UserId' value='"+Rfs.rapport.UserId+"'/>";a+="<input type='hidden' name='Date' value='"+Rfs.rapport.Date+"'/>";a+="<input type='submit' style='display:none' data-role='none'/>";a+="<fieldset>";for(d=0;d<c.length;d++){var b=
c[d];if(!b.Data)b.Data="";if(b.Permission==0)switch(handled=!0,b.TypeId){case 16:a+="<input type='hidden' name='Geometri' value='"+b.Data+"' id='Geometri'";b.Required==1&&(a+=" class='required'");a+="/>";break;case 17:a+="<input type='hidden' name='Position' value='"+b.Data+"' id='Position'";b.Required==1&&(a+=" class='required'");a+="/>";break;case 18:a+="<input type='hidden' name='Accuracy' value='"+b.Data+"' id='Accuracy'";b.Required==1&&(a+=" class='required'");a+="/>";break;default:a+="<input type='hidden' name='"+
b.Id+"' value='"+b.Data+"' id='"+b.Id+"'",b.Required==1&&(a+=" class='required'"),a+="/>"}else switch(b.TypeId){case 1:a+="<div data-role='fieldcontain'>";a+="<label for='"+b.Id+"'>"+b.Name+"</label>";a+="</div>";break;case 2:a+="<div data-role='fieldcontain'>";a+="<label for='"+b.Id+"'>";b.Required==1&&(a+="<em>*</em>");a+=b.Name+"</label>";a+="<input type='text' id='"+b.Id+"' name='"+b.Id+"' value='"+b.Data+"'";b.Required==1&&(a+=" class='required'");b.Permission==1&&(a+=" disabled='disabled'");
a+=" />";a+="</div>";break;case 3:a+="<div data-role='fieldcontain'>";a+="<label for='"+b.Id+"'>";b.Required==1&&(a+="<em>*</em>");a+=b.Name+"</label>";a+="<select id='"+b.Id+"' name='"+b.Id+"' value='"+b.Data+"'";b.Required==1&&(a+=" class='required'");b.Permission==1&&(a+=" disabled='disabled'");a+=">";a+="<option value='' data-placeholder='true'>-- V\u00e6lg --</option>";for(var e=b.Selections,h=0;h<e.length;h++){var g=e[h];a+="<option value='"+g.Name+"'";g.Selected==1&&(a+=" selected='selected'");
a+=">"+g.Name+"</option>"}a+="</select>";a+="</div>";break;case 4:a+="<div data-role='fieldcontain'>";a+="<div data-role='controlgroup'><legend>";b.Required==1&&(a+="<em>*</em>");a+=b.Name+"</legend>";e=b.Selections;for(h=0;h<e.length;h++)g=e[h],a+="<input type='radio' id='"+g.Id+"' name='"+b.Id+"' value='"+g.Name+"'",g.Selected==1&&(a+=" checked='checked'"),b.Required==1&&(a+=" class='required'"),b.Permission==1&&(a+=" disabled='disabled'"),a+="/><label for='"+g.Id+"'>"+g.Name+"</label>";a+="</div>";
a+="</div>";break;case 5:a+="<div data-role='fieldcontain'>";a+="<label for='"+b.Id+"'>";b.Required==1&&(a+="<em>*</em>");a+=b.Name+"</label>";a+="<textarea id='"+b.Id+"' name='"+b.Id+"'";b.Required==1&&(a+=" class='required'");b.Permission==1&&(a+=" disabled='disabled'");a+=">";a+=b.Data;a+="</textarea>";a+="</div>";break;case 6:case 12:case 13:a+="<div data-role='fieldcontain'>";a+="<label for='"+b.Id+"'>";b.Required==1&&(a+="<em>*</em>");a+=b.Name+"</label>";a+="<select id='"+b.Id+"' name='"+b.Id+
"' data-role='slider'";b.Required==1&&(a+=" class='required'");b.Permission==1&&(a+=" disabled='disabled'");a+=">";a+="<option value='off'>Nej</option>";a+=b.Data.toLowerCase()=="true"?"<option value='on' selected='selected'>Ja</option>":"<option value='on'>Ja</option>";a+="</select>";a+="</div>";break;case 7:a+="<div data-role='fieldcontain'>";a+="<label for='"+b.Id+"'>";b.Required==1&&(a+="<em>*</em>");a+=b.Name+"</label>";a+="<input type='email' id='"+b.Id+"' name='"+b.Id+"' value='"+b.Data+"'";
b.Required==1&&(a+=" class='required'");b.Permission==1&&(a+=" disabled='disabled'");a+=" />";a+="</div>";break;case 8:a+=markupCamera(b);break;case 10:a+=markupDate(b);break;case 14:a+="<div data-role='fieldcontain'>";a+="<a data-role='button' data-inline='true' href='"+b.Data+"'>"+b.Name+"</a>";a+="</div>";break;case 15:a+="<div data-role='fieldcontain'>";a+="<label for='"+b.Id+"'>";b.Required==1&&(a+="<em>*</em>");a+=b.Name+"</label>";a+="<input type='text' id='"+b.Id+"' name='"+b.Id+"' value='"+
b.Data+"'";b.Required==1&&(a+=" class='required'");b.Permission==1&&(a+=" disabled='disabled'");a+=" />";a+="</div>";break;case 16:a+="<div data-role='fieldcontain'>";a+="<label for='Geometri'>";b.Required==1&&(a+="<em>*</em>");a+=b.Name+"</label>";a+="<textarea id='Geometri' name='Geometri'";b.Required==1&&(a+=" class='required'");b.Permission==1&&(a+=" disabled='disabled'");a+=">";a+=b.Data;a+="</textarea>";a+="</div>";break;case 17:a+="<div data-role='fieldcontain'>";a+="<label for='Position'>";
b.Required==1&&(a+="<em>*</em>");a+=b.Name+"</label>";a+="<textarea id='Position' name='Position'";b.Required==1&&(a+=" class='required'");b.Permission==1&&(a+=" disabled='disabled'");a+=">";a+=b.Data;a+="</textarea>";a+="</div>";break;case 18:a+="<div data-role='fieldcontain'>";a+="<label for='Accuracy'>";b.Required==1&&(a+="<em>*</em>");a+=b.Name+"</label>";a+="<input type='text' id='Accuracy' name='Accuracy' value='"+b.Data+"'";b.Required==1&&(a+=" class='required'");b.Permission==1&&(a+=" disabled='disabled'");
a+=" />";a+="</div>";break;case 22:a+="<hr />";break;case 23:a+="<h1>"+b.Name+"</h1>";break;case 24:a+="<p>"+b.Name+"</p>"}}a+="</fieldset>";formularInit?$("#rapportForm").html(a).trigger("create"):$("#rapportForm").html(a);$(":file").bind("change",this.inputChanged);$("#rapportForm").validate({ignore:"",highlight:function(b){b.type&&b.type=="radio"?$(b.parentElement.parentElement).children().find("label").addClass("highlighterror"):b.type&&b.type=="textarea"?$(b).addClass("highlighterror"):$(b.parentElement).addClass("highlighterror")},
unhighlight:function(b){b.type&&b.type=="radio"?$(b.parentElement.parentElement).children().find("label").removeClass("highlighterror"):b.type&&b.type=="textarea"?$(b).removeClass("highlighterror"):$(b.parentElement).removeClass("highlighterror")},errorPlacement:function(b,a){a[0].type&&a[0].type=="radio"?b.insertAfter($(a).parent().parent()):a[0].type&&a[0].type=="select-one"?b.insertAfter($(a).parent().parent()):a[0].type&&a[0].type=="textarea"?b.insertAfter($(a)):b.insertAfter($(a).parent())}});
Rfs.showInfo=!0;createMap()},inputChanged:function(){imageId=this.name.substring(1);if(html5File()){var c=this.files[0];if(c.type.match("image.*")){var a=new FileReader;a.onload=function(){return function(a){$("#A"+imageId).attr("src",a.target.result).css("display","inline");$("#"+imageId).val(a.target.result);a=$("input[name='B"+imageId+"']");if(a.length>0)a.unbind("change"),a[0].outerHTML=a[0].outerHTML,$("input[name='B"+imageId+"']").bind("change",Rfs.inputChanged)}}(c);a.readAsDataURL(c)}}},showPosition:function(){$.mobile.showPageLoadingMsg("a",
"Henter temaer...",!1);$.ajax({url:url,dataType:"jsonp",timeout:vent,data:{x:x,y:y},success:function(c){Rfs.kommune=c;if(c.ModtagerIndberetning)location.hash="#/kommune/"+c.Nr;else{var a=$("#ModtagerIkkeIndberetning"),d=a.children(":jqmData(role=content)"),b="";b+="<h2>Du st\u00e5r i "+c.Navn+" Kommune</h2>";b+="<p>RapportFraStedet kan ikke indberette til denne kommune!</p>";Rfs.kommune.Besked!=""&&(b+="<p>"+c.Besked+"</p>");c.URL!=""&&(b+="<a href='"+c.URL+"' rel='external' data-ajax='false' data-role='button'>Kontakt</a>");
b+="<p>Du kan v\u00e6lge at indberette til en anden kommune.</p>";b+="<a href='#/kommuner' data-role='button' data-theme='b' >V\u00e6lg kommune</a>";d.html(b);a.trigger("create");location.hash="#/kommune/"+c.Nr+"/dialog"}},error:function(){location.hash="#/kommuner/fejl"},complete:function(){$.mobile.hidePageLoadingMsg()}})},Validate:function(){$("#rapportForm").valid()&&$("#Confirm").popup("open",{positionTo:"window",transition:"pop"})},checkIndberetning:function(){Rfs.ajaxCheck!=null&&Rfs.ajaxCheck.abort();
var c=$("#Position");c.length>0&&Rfs.lon&&Rfs.lat&&c.val("POINT("+Rfs.lon+" "+Rfs.lat+")");c=$("#Accuracy");c.length>0&&Rfs.acc&&c.val(Rfs.acc);c=$("#Geometri");c.length>0?($.mobile.showPageLoadingMsg("a","Validerer placering...",!1),Rfs.ajaxCheck=$.ajax({url:Rfs.url+"/api/Tema.aspx",dataType:"jsonp",timeout:vent,data:{id:Rfs.tema.Id,geometri:c.val()},success:function(a){a==!0?location="#/kommune/"+Rfs.kommune.Nr+"/"+Rfs.tema.Id+"/formular":$("#GeometryError").popup("open")},error:function(){$("#errorValidateLocation").popup("open")},
complete:function(){$.mobile.hidePageLoadingMsg()}})):$("#GeometryError").popup("open")}},kommuneNr=null,oiorest={kommuneNr:null,kommuner:null,vejNr:null,ajax:[],items:null,activeSearch:null,search:function(c){for(var a=0;a<this.items.length;a++)if(this.items[a].text1!=c)this.items[a].text1=c,this.items[a].search1()},init:function(){$("#searchOptions>.ui-controlgroup-controls").html("");$("#searchResult1").html("");this.items=[];$("#SearchPage1").page();$("#SearchPage2").page();$("#SearchPage3").page();
$("#searchInput2").bind("keyup change",function(){var c=$(this).val();if(c.length>=oiorest.activeSearch.chars2&&oiorest.activeSearch.text2!=c)oiorest.activeSearch.text2=c,oiorest.activeSearch.search2()});$("#searchInput3").bind("keyup change",function(){var c=$(this).val();if(c.length>=oiorest.activeSearch.chars3&&oiorest.activeSearch.text3!=c)oiorest.activeSearch.text3=c,oiorest.activeSearch.search3()})}};
Search=function(c,a,d){this.id=c;this.title=a;this.checked=d;this.chars3=this.chars2=this.chars1=this.placeholder3=this.placeholder2=this.placeholder1=this.name3=this.name2=this.name1=this.id3=this.id2=this.id1=this.url3=this.url2=this.url1=this.title3=this.title2=this.title1=this.projection=this.url=this.y2=this.x2=this.y1=this.x1=this.ajax=null;this.text3=this.text2=this.text1="";this.selection3=this.selection2=this.selection1=null;var b=this;$("<ul>",{id:"searchList"+this.id,"data-role":"listview",
"data-inset":"true","data-count-theme":"b"}).appendTo("#searchResult1").listview();this.createCheckBox=function(){var a=$("<input>",{name:"searchOption"+this.id,id:"searchOption"+this.id,type:"checkbox"});b.checked&&a.attr("checked","checked");a.bind("change",function(a){b.checked=a.target.checked;b.checked?b.search1():$("#searchList"+b.id).html("")});a.appendTo("#searchOptions");$("<label>",{"for":"searchOption"+b.id,text:this.title}).appendTo("#searchOptions")};this.search1=function(){if(b.checked&&
($("#searchList"+b.id).html(""),b.text1.length>=b.chars1))b.ajax!=null&&b.ajax.abort(),$.mobile.showPageLoadingMsg("a","S\u00f8ger...",!1),b.ajax=$.ajax({url:b.url1.replace("[text]",b.text1).replace("[kommune]",Rfs.kommune.Nr),dataType:"jsonp",timeout:vent,success:function(a){$("<li data-role='list-divider'>"+b.title1+"<span class='ui-li-count'>"+a.length+"</span></li>").appendTo("#searchList"+b.id);for(var c=0;c<a.length;c++){for(var d=b.name1,j=b.name1.match(/\[.+?\]/g);j.length;)var f=j.shift(),
k=getPath(a[c],f.replace("[","").replace("]","")),d=d.replace(f,k);b.addItem1(getPath(a[c],b.id1),d)}$("#searchList"+b.id).listview("refresh")},complete:function(){$.mobile.hidePageLoadingMsg()}})};this.search2=function(){$("#searchResult2").html("");b.ajax!=null&&b.ajax.abort();$.mobile.showPageLoadingMsg("a","S\u00f8ger...",!1);b.ajax=$.ajax({url:b.url2.replace("[text]",b.text2).replace("[kommune]",Rfs.kommune.Nr).replace("[selection1]",b.selection1),dataType:"jsonp",timeout:vent,success:function(a){for(var c=
0;c<a.length;c++){for(var d=b.name2,j=b.name2.match(/\[.+?\]/g);j.length;)var f=j.shift(),k=getPath(a[c],f.replace("[","").replace("]","")),d=d.replace(f,k);b.addItem2(getPath(a[c],b.id2),d)}$("#searchResult2").listview("refresh")},complete:function(){$.mobile.hidePageLoadingMsg()}})};this.search3=function(){$("#searchResult3").html("");b.ajax!=null&&b.ajax.abort();$.mobile.showPageLoadingMsg("a","S\u00f8ger...",!1);b.ajax=$.ajax({url:b.url3.replace("[text]",b.text3).replace("[kommune]",Rfs.kommune.Nr).replace("[selection1]",
b.selection1).replace("[selection2]",b.selection2),dataType:"jsonp",timeout:vent,success:function(a){for(var c=0;c<a.length;c++){for(var d=b.name3,j=b.name3.match(/\[.+?\]/g);j.length;)var f=j.shift(),k=getPath(a[c],f.replace("[","").replace("]","")),d=d.replace(f,k);b.addItem3(getPath(a[c],b.id3),d)}$("#searchResult3").listview("refresh")},complete:function(){$.mobile.hidePageLoadingMsg()}})};this.addItem1=function(a,c){$("<li>").append($("<a />",{text:c}).click(function(){oiorest.activeSearch=b;
b.selection1=a;b.url2?($("#SearchPage2").children(":jqmData(role=header)").find("h1").html(b.title2),$("#searchInput2").val(""),$("#searchInput2").attr("placeholder",b.placeholder2),$("#searchResult2").html(""),b.chars2>0?$("#searchHint2").html("Indtast minimum "+b.chars2+" karakterer!"):($("#searchHint2").html(""),b.text2="",b.search2()),location="#/kommune/"+Rfs.kommune.Nr+"/"+Rfs.tema.Id+"/find2"):b.getPosition(c)})).appendTo("#searchList"+b.id)};this.addItem2=function(a,c){$("<li>").append($("<a />",
{text:c}).click(function(){oiorest.activeSearch=b;b.selection2=a;b.url3?($("#SearchPage3").children(":jqmData(role=header)").find("h1").html(b.title3),$("#searchInput3").val(""),$("#searchInput3").attr("placeholder",b.placeholder3),$("#searchResult3").html(""),b.chars3>0?$("#searchHint3").html("Indtast minimum "+b.chars3+" karakterer!"):($("#searchHint3").html(""),b.text3="",b.search3()),location="#/kommune/"+Rfs.kommune.Nr+"/"+Rfs.tema.Id+"/find3"):b.getPosition(c)})).appendTo("#searchResult2")};
this.addItem3=function(a,c){$("<li>").append($("<a />",{text:c}).click(function(){oiorest.activeSearch=b;b.selection3=a;b.getPosition(c)})).appendTo("#searchResult3")};this.getPosition=function(a){b.ajax!=null&&b.ajax.abort();$.mobile.showPageLoadingMsg("a","S\u00f8ger...",!1);b.ajax=$.ajax({url:b.url.replace("[text]",a).replace("[kommune]",Rfs.kommune.Nr).replace("[selection1]",b.selection1).replace("[selection2]",b.selection2).replace("[selection3]",b.selection3),dataType:"jsonp",timeout:vent,success:function(a){var c=
null;try{c=map.projection.getCode()}catch(d){c=map.projection}var e=null,e=c=="ETRS89.UTM-32N"?new OpenLayers.Projection("EPSG:25832"):map.projection;b.x2?(c=new OpenLayers.Geometry.Point(getPath(a,b.x1),getPath(a,b.y1)),a=new OpenLayers.Geometry.Point(getPath(a,b.x2),getPath(a,b.y2)),c.transform(new OpenLayers.Projection(b.projection),mapPojection),a.transform(new OpenLayers.Projection(b.projection),e),e=new OpenLayers.Bounds(c.x,c.y,a.x,a.y),map.zoomToExtent(e)):(a=new OpenLayers.Geometry.Point(getPath(a,
b.x1),getPath(a,b.y1)),a.transform(new OpenLayers.Projection(b.projection),e),vector.removeAllFeatures(),vector.addFeatures([new OpenLayers.Feature.Vector(a,{},{graphicName:"cross",strokeColor:"#f00",strokeWidth:2,fillOpacity:0,pointRadius:10})]),map.zoomToExtent(vector.getDataExtent()));reverse=!0;location="#/kommune/"+Rfs.kommune.Nr+"/"+Rfs.tema.Id},complete:function(){$.mobile.hidePageLoadingMsg()}})}};
function getPath(c,a){c.length>0&&(c=c[0]);for(var d=a.split(".");d.length&&c;)c=c[d.shift()];return c}var apiKey="AuNxzdIgj_DsnHh_sCAkkhlwPbfe1B-m890rn4sjfAG1niRi3lCjtxunctjRCn-Q",map,activeControl,pointControl,pathControl,polygonControl,modifyControl,removeControl,navigationControl,redline,vector,crosshairsLayer,crosshairMarker,icon,geolocate,startLocate;
function Point(){$("#tegnPunkt").addClass("checked");$("#tegnLinie").removeClass("checked");$("#tegnPolygon").removeClass("checked");$("#tegnRediger").removeClass("checked");$("#tegnSlet").removeClass("checked");$("#tegnNaviger").removeClass("checked");activeControl&&activeControl.deactivate();activeControl=pointControl;activeControl.activate()}
function Line(){$("#tegnPunkt").removeClass("checked");$("#tegnLinie").addClass("checked");$("#tegnPolygon").removeClass("checked");$("#tegnRediger").removeClass("checked");$("#tegnSlet").removeClass("checked");$("#tegnNaviger").removeClass("checked");activeControl&&activeControl.deactivate();activeControl=pathControl;activeControl.activate()}
function Polygon(){$("#tegnPunkt").removeClass("checked");$("#tegnLinie").removeClass("checked");$("#tegnPolygon").addClass("checked");$("#tegnRediger").removeClass("checked");$("#tegnSlet").removeClass("checked");$("#tegnNaviger").removeClass("checked");activeControl&&activeControl.deactivate();activeControl=polygonControl;activeControl.activate()}
function Modify(){$("#tegnPunkt").removeClass("checked");$("#tegnLinie").removeClass("checked");$("#tegnPolygon").removeClass("checked");$("#tegnRediger").addClass("checked");$("#tegnSlet").removeClass("checked");$("#tegnNaviger").removeClass("checked");activeControl&&activeControl.deactivate();activeControl=modifyControl;activeControl.activate()}
function Navigate(){$("#tegnPunkt").removeClass("checked");$("#tegnLinie").removeClass("checked");$("#tegnPolygon").removeClass("checked");$("#tegnRediger").removeClass("checked");$("#tegnSlet").removeClass("checked");$("#tegnNaviger").addClass("checked");activeControl&&activeControl.deactivate();activeControl=null}
function Move(){if(Rfs.showMarker){var c=map.getExtent();crosshairMarker&&crosshairsLayer.removeMarker(crosshairMarker);crosshairMarker=new OpenLayers.Marker(new OpenLayers.LonLat(c.left+(c.right-c.left)/2,c.bottom+(c.top-c.bottom)/2),icon);crosshairsLayer.addMarker(crosshairMarker);if(Rfs.rapport&&Rfs.rapport.SRS){var a=$("#Geometri");if(a.length>0){var d=null;try{d=map.projection.getCode()}catch(b){d=map.projection}var e=null,e=d=="ETRS89.UTM-32N"?new OpenLayers.Projection("EPSG:25832"):map.projection,
d=new OpenLayers.Projection(Rfs.rapport.SRS),c=new OpenLayers.Geometry.Point(c.left+(c.right-c.left)/2,c.bottom+(c.top-c.bottom)/2);c.transform(e,d);a.val(c.toString())}}}}
function initMap(){startLocate=!0;crosshairsLayer=new OpenLayers.Layer.Markers("Crosshairs Layer");vector=new OpenLayers.Layer.Vector("Vector Layer",{});var c=new OpenLayers.Size(100,100),a=new OpenLayers.Pixel(-50,-50);icon=new OpenLayers.Icon("./img/crosshair.png",c,a);redline=new OpenLayers.Layer.Vector("Redline Layer",{styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{Point:{pointRadius:20,graphicName:"circle",fillColor:"white",fillOpacity:0.25,
strokeWidth:3,strokeOpacity:1,strokeColor:"#ff6600"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#ff6600"},Polygon:{strokeWidth:3,strokeOpacity:1,fillColor:"#ff6600",strokeColor:"#ff6600"}}})]}),select:new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{Point:{pointRadius:20,graphicName:"circle",fillColor:"white",fillOpacity:0.25,strokeWidth:3,strokeOpacity:1,strokeColor:"#ff9900"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#ff9900"},Polygon:{strokeWidth:3,strokeOpacity:1,
fillColor:"#ff9900",strokeColor:"#ff9900"}}})]}),temporary:new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{Point:{graphicName:"circle",pointRadius:20,fillColor:"white",fillOpacity:0.25,strokeWidth:3,strokeColor:"#ff3300"},Line:{pointRadius:20,strokeWidth:3,strokeOpacity:1,strokeColor:"#ff3300"},Polygon:{strokeWidth:3,strokeOpacity:1,strokeColor:"#ff3300",fillColor:"#ff3300"}}})]})})});redline.events.register("beforefeatureadded",this,function(b){redline.removeAllFeatures();if(Rfs.rapport&&
Rfs.rapport.SRS){var a=$("#Geometri");if(a.length>0){var c=null;try{c=map.projection.getCode()}catch(d){c=map.projection}var j=null,j=c=="ETRS89.UTM-32N"?new OpenLayers.Projection("EPSG:25832"):map.projection,c=new OpenLayers.Projection(Rfs.rapport.SRS),b=b.feature.geometry.clone();b.transform(j,c);a.val(b.toString())}}});modifyControl=new OpenLayers.Control.ModifyFeature(redline);pointControl=new OpenLayers.Control.DrawFeature(redline,OpenLayers.Handler.Point);pathControl=new OpenLayers.Control.DrawFeature(redline,
OpenLayers.Handler.Path);polygonControl=new OpenLayers.Control.DrawFeature(redline,OpenLayers.Handler.Polygon);navigationControl=new OpenLayers.Control.Navigation({dragPanOptions:{enableKinetic:!0}});geolocate=new OpenLayers.Control.Geolocate({id:"locate-control",geolocationOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6E4}});var d={fillOpacity:0.1,fillColor:"#000",strokeColor:"#f00",strokeOpacity:0.6};geolocate.events.register("locationfailed",this,function(b){var a="<p>";switch(b.error.code){case 1:a+=
"Det er ikke tilladt at bruge GPS enheden";break;case 2:a+="Der kunne ikke opn\u00e5s en position";break;case 3:a+="Der skete en timeout ved bestemmelse af positionen"}a+="</p><p>"+b.error.message+"</p>";$("#LocationErrorMessage").html(a);$("#LocationError").popup("open")});geolocate.events.register("locationupdated",this,function(a){Rfs.lat=a.position.coords.latitude;Rfs.lon=a.position.coords.longitude;Rfs.acc=a.position.coords.accuracy;vector.removeAllFeatures();vector.addFeatures([new OpenLayers.Feature.Vector(a.point,
{},{graphicName:"cross",strokeColor:"#f00",strokeWidth:2,fillOpacity:0,pointRadius:10}),new OpenLayers.Feature.Vector(OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(a.point.x,a.point.y),a.position.coords.accuracy/2,50,0),{},d)]);map.zoomToExtent(vector.getDataExtent());Rfs.useDrawControl||vector.removeAllFeatures()});map=new OpenLayers.Map({div:"map",theme:null,controls:[geolocate,pointControl,pathControl,polygonControl,modifyControl,navigationControl],layers:[redline,
vector,crosshairsLayer],eventListeners:{move:Move}});$("#plus").click(function(){map.zoomIn()});$("#minus").click(function(){map.zoomOut()});$(window).bind("resize orientationchange",function(){fixContentHeight()});map.events.register("zoomend",this,function(){startLocate&&(startLocate=!1,locate())});createMap()}function locate(){geolocate.active?geolocate.getCurrentLocation():geolocate.activate()}
function createMap(){if(map&&Rfs.mapSet){geolocate.deactivate();startLocate=!0;crosshairMarker&&crosshairsLayer.removeMarker(crosshairMarker);redline.removeAllFeatures();Navigate();$("#layerslist").html("<li data-role='divider' data-theme='a'>Baggrundskort</li>");var c=map.layers.length;for(i=0;i<c;i++)map.removeLayer(map.layers[0],!1);map.addLayer(redline);map.addLayer(vector);map.addLayer(crosshairsLayer);c=!1;for(mapGroupItem in Rfs.mapSet.MapGroup)for(mapItem in Rfs.mapSet.MapGroup[mapGroupItem].Map){var a=
Rfs.mapSet.MapGroup[mapGroupItem].Map[mapItem];switch(a.Type[0]){case "WMTS":wmts(a);break;case "MapGuide":mapguide(a);break;case "OpenStreetMap":c=new OpenLayers.Layer.OSM(a.Extension[0].Options[0].name[0]);map.addLayer(c);addLayerToList({ol:c,name:c.name});c=!0;break;case "Google":var d=a.Extension[0].Options[0].name[0];switch(a.Extension[0].Options[0].type[0]){case "G_PHYSICAL_MAP":case "TERRAIN":c=new OpenLayers.Layer.Google(d,{type:google.maps.MapTypeId.TERRAIN});map.addLayer(c);addLayerToList({ol:c,
name:c.name});c=!0;break;case "G_HYBRID_MAP":case "HYBRID":c=new OpenLayers.Layer.Google(d,{type:google.maps.MapTypeId.HYBRID});map.addLayer(c);addLayerToList({ol:c,name:c.name});c=!0;break;case "G_SATELLITE_MAP":case "SATELLITE":c=new OpenLayers.Layer.Google(d,{type:google.maps.MapTypeId.SATELLITE});map.addLayer(c);addLayerToList({ol:c,name:c.name});c=!0;break;case "G_NORMAL_MAP":case "ROADMAP":c=new OpenLayers.Layer.Google(d,{type:google.maps.MapTypeId.ROADMAP}),map.addLayer(c),addLayerToList({ol:c,
name:c.name}),c=!0}break;case "VirtualEarth":switch(d=a.Extension[0].Options[0].name[0],a.Extension[0].Options[0].type[0]){case "Road":c=new OpenLayers.Layer.Bing({key:apiKey,type:"Road",metadataParams:{mapVersion:"v1"},name:d});map.addLayer(c);addLayerToList({ol:c,name:c.name});c=!0;break;case "Aerial":c=new OpenLayers.Layer.Bing({key:apiKey,type:"Aerial",name:d});map.addLayer(c);addLayerToList({ol:c,name:c.name});c=!0;break;case "Hybrid":c=new OpenLayers.Layer.Bing({key:apiKey,type:"AerialWithLabels",
name:d}),map.addLayer(c),addLayerToList({ol:c,name:c.name}),c=!0}}}c&&($("#layerslist").listview("refresh"),map.zoomToMaxExtent());if(Rfs.showInfo)Rfs.showInfo=!1,Rfs.useDrawControl?$("#KortInfoDraw").popup("open"):$("#KortInfo").popup("open")}}
function wmts(c){OpenLayers.ProxyHost="proxy.cgi?url=";var a=c.Extension[0].Options[0].url[0].replace(/%26/gi,"&");OpenLayers.Request.GET({url:a,params:{SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetCapabilities"},success:function(d){OpenLayers.ProxyHost=null;var b={layer:c.Extension[0].Options[0].layer[0],matrixSet:c.Extension[0].Options[0].matrixSet[0],style:c.Extension[0].Options[0].style[0],url:a,units:c.Extension[0].Options[0].units[0]},e=d.responseXML;if(!e||!e.documentElement)e=d.responseText;
d=new OpenLayers.Format.WMTSCapabilities;e=d.read(e);d=d.createLayer(e,b);d.options.resolutions=Array(d.matrixIds.length);for(var h=0;h<d.matrixIds.length;h++)d.options.resolutions[h]=d.matrixIds[h].scaleDenominator*2.8E-4;d.options.maxExtent=e.contents.tileMatrixSets[b.matrixSet].bounds;d.maxExtent=d.options.maxExtent;d.projection=new OpenLayers.Projection(c.Extension[0].ProjectionCode[0]);d.wrapDateLine=!1;map.addLayer(d);map.projection=d.projection;map.units=d.units;map.maxExtent=d.maxExtent;addLayerToList({ol:d,
name:d.name});$("#layerslist").listview("refresh");map.zoomToMaxExtent();locate()},failure:function(){alert("Trouble getting capabilities doc")}})}
function mapguide(c){var a=Rfs.tema.MapAgent.toLowerCase().replace("mapagent/mapagent.fcgi","fusion")+"/layers/mapguide/php/";$.ajax({url:a+"createsession.php",data:{username:"Anonymous"},dataType:"jsonp",timeout:vent,success:function(d){$.ajax({url:a+"loadmap.php",type:"POST",data:{mapid:c.Extension[0].ResourceId[0],session:d.sessionId},dataType:"jsonp",timeout:vent,success:function(a){var d=OpenLayers.INCHES_PER_UNIT.m*a.metersPerUnit;OpenLayers.INCHES_PER_UNIT.dd=d;OpenLayers.INCHES_PER_UNIT.degrees=
d;OpenLayers.DOTS_PER_INCH=96;d=!0;c.Extension[0].Options&&c.Extension[0].Options[0].isBaseLayer&&c.Extension[0].Options[0].isBaseLayer[0]=="false"&&(d=!1);var h=!1;c.Extension[0].Options&&c.Extension[0].Options[0].useOverlay&&c.Extension[0].Options[0].useOverlay[0]=="true"&&(h=!0);var g=!0;c.SingleTile&&c.SingleTile[0]=="False"&&(g=!1);var j=!1;c.Extension[0].Options&&c.Extension[0].Options[0].useHttpTile&&c.Extension[0].Options[0].useHttpTile[0]=="true"&&(j=!0);var f="";c.Extension[0].Options&&
c.Extension[0].Options[0].format&&(f=c.Extension[0].Options[0].format[0]);c.Extension[0].ImageFormat&&(f=c.Extension[0].ImageFormat[0]);var k={isBaseLayer:d,useOverlay:h,useAsyncOverlay:!0,singleTile:g,useHttpTile:j,units:"m",maxExtent:new OpenLayers.Bounds.fromArray(a.extent)};j?(g={basemaplayergroupname:a.groups[0].groupName},f!=""&&(g.format=f),k.scales=a.FiniteDisplayScales,f=new OpenLayers.Layer.MapGuide(a.mapTitle,c.Extension[0].Options[0].tileCacheUrl[0].split(","),g,k)):(g?(map.projection=
"EPSG:"+a.epsg,g={mapname:a.mapName,session:a.sessionId,behavior:2},f!=""&&(g.format=f),k.maxResolution="auto",k.maxScale=1,k.minScale=1E12,k.units="m"):(g={mapdefinition:a.mapId,session:a.sessionId,basemaplayergroupname:a.groups[0].groupName},f!=""&&(g.format=f),k.scales=a.FiniteDisplayScales),f=new OpenLayers.Layer.MapGuide(a.mapTitle,Rfs.tema.MapAgent,g,k));map.addLayer(f);$("#map").css("background-color",a.backgroundColor);startLocate&&d&&map.zoomToExtent(f.maxExtent);h?(map.removeLayer(redline,
!1),map.removeLayer(vector,!1),map.removeLayer(crosshairsLayer,!1),map.addLayer(redline),map.addLayer(vector),map.addLayer(crosshairsLayer)):addLayerToList({ol:f,name:f.name});if(!j){Rfs.FeatureInfo&&(d=new OpenLayers.Control.MapGuideGetFeatureInfo({url:Rfs.tema.MapAgent,layer:f,maxFeatures:-1,persist:1,layerAttributeFilter:3}),map.addControl(d),d.activate());for(d=0;d<a.layers.length;d++)h=a.layers[d],h.displayInLegend&&addLayerToList({ol:f,name:h.legendLabel,id:h.uniqueId})}$("#layerslist").listview("refresh")},
error:function(a,c){alert(c)}})},error:function(a,b){alert(b)}})}function fixContentHeight(){var c=$(window).height(),a=$("#headerKort"),d=$("#kortnavbar"),d=d.css("display")=="none"?c-a.outerHeight():c-d.outerHeight()-a.outerHeight();$("#map").css("height",d);$("#navigation").css("top",a.outerHeight()+10);window.map&&map.updateSize();$("#Photo").css("height",c);c=$("#photoButton");a=$(window).width();d=c.outerWidth();c.css("left",(a-d)/2)}
function addLayerToList(c){if(c.ol.isBaseLayer)map.projection=c.ol.projection.getCode();var a=$("<li>",{"data-icon":"check","class":c.ol.visibility?"checked":""}).append($("<a />",{text:c.name}).click(function(){if(c.ol.CLASS_NAME=="OpenLayers.Layer.MapGuide"&&typeof c.id!=="undefined"){a.toggleClass("checked");if(a.hasClass("checked")){if(typeof c.ol.params.hideLayers!=="undefined")c.ol.params.hideLayers=c.ol.params.hideLayers.replace(c.id,"").replace(",,",",");c.ol.params.showLayers=typeof c.ol.params.showLayers===
"undefined"?c.id:c.ol.params.showLayers+","+c.id}else{if(typeof c.ol.params.showLayers!=="undefined")c.ol.params.showLayers=c.ol.params.showLayers.replace(c.id,"").replace(",,",",");c.ol.params.hideLayers=typeof c.ol.params.hideLayers==="undefined"?c.id:c.ol.params.hideLayers+","+c.id}c.ol.redraw()}else c.ol.isBaseLayer&&c.name==c.ol.name?(map.projection=c.ol.projection.getCode(),map.maxExtent=c.maxExtent,map.units=c.units,map.setBaseLayer(c.ol)):c.ol.setVisibility(!c.ol.getVisibility())})).appendTo("#layerslist");
c.ol.events.on({visibilitychanged:function(){$(a).toggleClass("checked")}})};
